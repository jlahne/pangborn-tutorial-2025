<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Fine-Tuning Publication-Quality ggplots | Publication-quality data visualizations using the R tidyverse</title>
  <meta name="description" content="3 Fine-Tuning Publication-Quality ggplots | Publication-quality data visualizations using the R tidyverse" />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Fine-Tuning Publication-Quality ggplots | Publication-quality data visualizations using the R tidyverse" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="jlahne/pangborn-tutorial-2025" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Fine-Tuning Publication-Quality ggplots | Publication-quality data visualizations using the R tidyverse" />
  
  
  

<meta name="author" content="Jacob Lahne" />
<meta name="author" content="Kyle Hamilton" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="the-basics-of-plotting-with-ggplot2.html"/>
<link rel="next" href="wrap-up-and-further-resources.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction and welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#introductions"><i class="fa fa-check"></i>Introductions</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#kyle-hamilton-phd"><i class="fa fa-check"></i>Kyle Hamilton, PhD</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#jacob-lahne-phd"><i class="fa fa-check"></i>Jacob Lahne, PhD</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#elizabeth-clark-phd"><i class="fa fa-check"></i>Elizabeth Clark, PhD</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#todays-agenda"><i class="fa fa-check"></i>Today’s agenda</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-were-going-to-run"><i class="fa fa-check"></i>How we’re going to run</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#recommended-approach-for-livecoding"><i class="fa fa-check"></i>Recommended approach for livecoding</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#dealing-with-errors"><i class="fa fa-check"></i>Dealing with errors</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#psa-not-knowing-is-normal"><i class="fa fa-check"></i>PSA: not-knowing is normal!</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#getting-help"><i class="fa fa-check"></i>Getting Help</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="importing-and-wrangling-data.html"><a href="importing-and-wrangling-data.html"><i class="fa fa-check"></i><b>1</b> Importing and wrangling data</a>
<ul>
<li class="chapter" data-level="1.1" data-path="importing-and-wrangling-data.html"><a href="importing-and-wrangling-data.html#motivation-exploring-berry-and-cider-cataliking-data"><i class="fa fa-check"></i><b>1.1</b> Motivation: exploring berry and cider CATA/liking data</a></li>
<li class="chapter" data-level="1.2" data-path="importing-and-wrangling-data.html"><a href="importing-and-wrangling-data.html#getting-data-into-r"><i class="fa fa-check"></i><b>1.2</b> Getting data into <code>R</code></a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="importing-and-wrangling-data.html"><a href="importing-and-wrangling-data.html#where-the-data-live"><i class="fa fa-check"></i><b>1.2.1</b> Where the data live</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="importing-and-wrangling-data.html"><a href="importing-and-wrangling-data.html#the-destination"><i class="fa fa-check"></i><b>1.3</b> The destination</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="importing-and-wrangling-data.html"><a href="importing-and-wrangling-data.html#cider"><i class="fa fa-check"></i><b>1.3.1</b> Cider</a></li>
<li class="chapter" data-level="1.3.2" data-path="importing-and-wrangling-data.html"><a href="importing-and-wrangling-data.html#berries"><i class="fa fa-check"></i><b>1.3.2</b> Berries</a></li>
<li class="chapter" data-level="1.3.3" data-path="importing-and-wrangling-data.html"><a href="importing-and-wrangling-data.html#pubquality"><i class="fa fa-check"></i><b>1.3.3</b> “Publication quality”</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="importing-and-wrangling-data.html"><a href="importing-and-wrangling-data.html#saving-your-data"><i class="fa fa-check"></i><b>1.4</b> Saving your data</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="importing-and-wrangling-data.html"><a href="importing-and-wrangling-data.html#a-note-on-replicability"><i class="fa fa-check"></i><b>1.4.1</b> A note on replicability</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="importing-and-wrangling-data.html"><a href="importing-and-wrangling-data.html#wrap-up"><i class="fa fa-check"></i><b>1.5</b> Wrap up</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="the-basics-of-plotting-with-ggplot2.html"><a href="the-basics-of-plotting-with-ggplot2.html"><i class="fa fa-check"></i><b>2</b> The basics of plotting with <code>ggplot2</code></a>
<ul>
<li class="chapter" data-level="2.1" data-path="the-basics-of-plotting-with-ggplot2.html"><a href="the-basics-of-plotting-with-ggplot2.html#your-first-ggplot"><i class="fa fa-check"></i><b>2.1</b> Your first <code>ggplot()</code></a></li>
<li class="chapter" data-level="2.2" data-path="the-basics-of-plotting-with-ggplot2.html"><a href="the-basics-of-plotting-with-ggplot2.html#the-aes-function-and-mapping-argument"><i class="fa fa-check"></i><b>2.2</b> The <code>aes()</code> function and <code>mapping =</code> argument</a></li>
<li class="chapter" data-level="2.3" data-path="the-basics-of-plotting-with-ggplot2.html"><a href="the-basics-of-plotting-with-ggplot2.html#adding-layers-with-geom_-functions"><i class="fa fa-check"></i><b>2.3</b> Adding layers with <code>geom_*()</code> functions</a></li>
<li class="chapter" data-level="2.4" data-path="the-basics-of-plotting-with-ggplot2.html"><a href="the-basics-of-plotting-with-ggplot2.html#arguments-inside-and-outside-of-aes"><i class="fa fa-check"></i><b>2.4</b> Arguments inside and outside of <code>aes()</code></a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="the-basics-of-plotting-with-ggplot2.html"><a href="the-basics-of-plotting-with-ggplot2.html#using-theme_-to-change-visual-options-quickly"><i class="fa fa-check"></i><b>2.4.1</b> Using <code>theme_*()</code> to change visual options quickly</a></li>
<li class="chapter" data-level="2.4.2" data-path="the-basics-of-plotting-with-ggplot2.html"><a href="the-basics-of-plotting-with-ggplot2.html#changing-aesthetic-elements-with-scale_-functions"><i class="fa fa-check"></i><b>2.4.2</b> Changing aesthetic elements with <code>scale_*()</code> functions</a></li>
<li class="chapter" data-level="2.4.3" data-path="the-basics-of-plotting-with-ggplot2.html"><a href="the-basics-of-plotting-with-ggplot2.html#finally-facet_"><i class="fa fa-check"></i><b>2.4.3</b> Finally, <code>facet_*()</code></a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="the-basics-of-plotting-with-ggplot2.html"><a href="the-basics-of-plotting-with-ggplot2.html#some-further-reading"><i class="fa fa-check"></i><b>2.5</b> Some further reading</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="fine-tuning-publication-quality-ggplots.html"><a href="fine-tuning-publication-quality-ggplots.html"><i class="fa fa-check"></i><b>3</b> Fine-Tuning Publication-Quality ggplots</a>
<ul>
<li class="chapter" data-level="3.1" data-path="fine-tuning-publication-quality-ggplots.html"><a href="fine-tuning-publication-quality-ggplots.html#exporting-and-saving-plots"><i class="fa fa-check"></i><b>3.1</b> Exporting and Saving Plots</a>
<ul>
<li class="chapter" data-level="" data-path="fine-tuning-publication-quality-ggplots.html"><a href="fine-tuning-publication-quality-ggplots.html#ggsave"><i class="fa fa-check"></i>Exporting Images with <code>ggsave()</code></a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="fine-tuning-publication-quality-ggplots.html"><a href="fine-tuning-publication-quality-ggplots.html#fine-tuning-bar-plots-facets-with-different-categorical-variables"><i class="fa fa-check"></i><b>3.2</b> Fine-tuning bar plots &amp; facets with different categorical variables</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="fine-tuning-publication-quality-ggplots.html"><a href="fine-tuning-publication-quality-ggplots.html#horizontal-text-with-coord_flip"><i class="fa fa-check"></i><b>3.2.1</b> Horizontal text with coord_flip()</a></li>
<li class="chapter" data-level="3.2.2" data-path="fine-tuning-publication-quality-ggplots.html"><a href="fine-tuning-publication-quality-ggplots.html#ordered-categorical-variables"><i class="fa fa-check"></i><b>3.2.2</b> Ordered Categorical Variables</a></li>
<li class="chapter" data-level="3.2.3" data-path="fine-tuning-publication-quality-ggplots.html"><a href="fine-tuning-publication-quality-ggplots.html#making-labels-look-okay-powerful-text-manipulation-with-stringr"><i class="fa fa-check"></i><b>3.2.3</b> Making labels look okay: Powerful text manipulation with <code>stringr</code></a></li>
<li class="chapter" data-level="3.2.4" data-path="fine-tuning-publication-quality-ggplots.html"><a href="fine-tuning-publication-quality-ggplots.html#removing-plot-elements"><i class="fa fa-check"></i><b>3.2.4</b> Removing Plot Elements</a></li>
<li class="chapter" data-level="3.2.5" data-path="fine-tuning-publication-quality-ggplots.html"><a href="fine-tuning-publication-quality-ggplots.html#putting-it-all-together"><i class="fa fa-check"></i><b>3.2.5</b> Putting it all together</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="fine-tuning-publication-quality-ggplots.html"><a href="fine-tuning-publication-quality-ggplots.html#fine-tuning-biplots-with-different-types-of-variables"><i class="fa fa-check"></i><b>3.3</b> Fine-tuning biplots with different types of variables</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="fine-tuning-publication-quality-ggplots.html"><a href="fine-tuning-publication-quality-ggplots.html#axis-and-plot-labels-based-on-variables"><i class="fa fa-check"></i><b>3.3.1</b> Axis and plot labels based on variables</a></li>
<li class="chapter" data-level="3.3.2" data-path="fine-tuning-publication-quality-ggplots.html"><a href="fine-tuning-publication-quality-ggplots.html#setting-up-the-cartesian-plane"><i class="fa fa-check"></i><b>3.3.2</b> Setting up the Cartesian plane</a></li>
<li class="chapter" data-level="3.3.3" data-path="fine-tuning-publication-quality-ggplots.html"><a href="fine-tuning-publication-quality-ggplots.html#using-only-part-of-the-dataset-for-each-geom"><i class="fa fa-check"></i><b>3.3.3</b> Using only part of the dataset for each geom</a></li>
<li class="chapter" data-level="3.3.4" data-path="fine-tuning-publication-quality-ggplots.html"><a href="fine-tuning-publication-quality-ggplots.html#tweaking-legends"><i class="fa fa-check"></i><b>3.3.4</b> Tweaking legends</a></li>
<li class="chapter" data-level="3.3.5" data-path="fine-tuning-publication-quality-ggplots.html"><a href="fine-tuning-publication-quality-ggplots.html#aesthetics-that-cant-use-scale_-functions"><i class="fa fa-check"></i><b>3.3.5</b> Aesthetics that can’t use scale_*() functions</a></li>
<li class="chapter" data-level="3.3.6" data-path="fine-tuning-publication-quality-ggplots.html"><a href="fine-tuning-publication-quality-ggplots.html#putting-it-all-together-1"><i class="fa fa-check"></i><b>3.3.6</b> Putting it all together</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="wrap-up-and-further-resources.html"><a href="wrap-up-and-further-resources.html"><i class="fa fa-check"></i><b>4</b> Wrap-up and further resources</a>
<ul>
<li class="chapter" data-level="4.1" data-path="wrap-up-and-further-resources.html"><a href="wrap-up-and-further-resources.html#getting-help-1"><i class="fa fa-check"></i><b>4.1</b> Getting help</a></li>
<li class="chapter" data-level="4.2" data-path="wrap-up-and-further-resources.html"><a href="wrap-up-and-further-resources.html#further-readingresources"><i class="fa fa-check"></i><b>4.2</b> Further reading/resources</a></li>
<li class="chapter" data-level="4.3" data-path="wrap-up-and-further-resources.html"><a href="wrap-up-and-further-resources.html#questionscomments"><i class="fa fa-check"></i><b>4.3</b> Questions/Comments</a></li>
<li class="chapter" data-level="4.4" data-path="wrap-up-and-further-resources.html"><a href="wrap-up-and-further-resources.html#references"><i class="fa fa-check"></i><b>4.4</b> References</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i>Appendix</a>
<ul>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html#using-ggplot2-with-other-packages"><i class="fa fa-check"></i>Using ggplot2 with other packages</a>
<ul>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html#new-theme_s-and-scale_s"><i class="fa fa-check"></i>New <code>theme_*()</code>s and <code>scale_*()</code>s</a></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html#finding-new-packages"><i class="fa fa-check"></i>Finding New Packages</a></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html#ggextend"><i class="fa fa-check"></i>Modifying <code>ggplot()</code>s made by other packages</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html#combining-plots"><i class="fa fa-check"></i>Combining Plots</a></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html#ggformat"><i class="fa fa-check"></i>Image File Types, Sizes, and Resolutions</a>
<ul>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html#what-image-format"><i class="fa fa-check"></i>What image format?</a></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html#simpler-sizing-vector-images"><i class="fa fa-check"></i>Simpler Sizing: Vector Images</a></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html#raster-image-resolutions"><i class="fa fa-check"></i>Raster Image Resolutions</a></li>
<li class="chapter" data-level="4.4.1" data-path="appendix.html"><a href="appendix.html#other-image-export-options"><i class="fa fa-check"></i><b>4.4.1</b> Other Image Export Options</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html#regex"><i class="fa fa-check"></i>Regular Expressions</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Publication-quality data visualizations using the R tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="fine-tuning-publication-quality-ggplots" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">3</span> Fine-Tuning Publication-Quality ggplots<a href="fine-tuning-publication-quality-ggplots.html#fine-tuning-publication-quality-ggplots" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The plots we’ve been making so far are fairly straightforward demonstrations. At the very end of Chapter 2, we briefly showed you the code and results for these two plots:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="fine-tuning-publication-quality-ggplots.html#cb40-1" tabindex="-1"></a>p1_berry_penalty</span></code></pre></div>
<p><img src="03-finetuning-ggplot_files/figure-html/pretty%20plot%20examples-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="fine-tuning-publication-quality-ggplots.html#cb41-1" tabindex="-1"></a>p2_ca_cider_cata</span></code></pre></div>
<p><img src="03-finetuning-ggplot_files/figure-html/pretty%20plot%20examples-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>We’re going to spend the rest of the workshop running through the tips and tricks we used to make these look polished. It’s not an exhaustive list of the things you can change or tweak, though, so more than anything, we hope you walk away with the ability to identify what parts of a plot you want to change and the skills to figure out how to change it.</p>
<p>But first, something that everyone will need for almost every plot:</p>
<div id="exporting-and-saving-plots" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Exporting and Saving Plots<a href="fine-tuning-publication-quality-ggplots.html#exporting-and-saving-plots" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>It may seem like a weird time to be talking about saving plots, when we haven’t gotten to the “fine-tuning” yet, but you’ve already seen a few examples of things that change when the aspect ratio of the plot or the monitor you’re viewing it on changes slightly. It is basically impossible to export a <code>ggplot</code> at the resolution needed for publishing without changing the aspect ratio, relative sizes, or space between some elements from what you’re looking at in the Plots pane or the <code>.Rmd</code> chunk output.</p>
<p>It’s good practice to export your plot as an image (or pdf or knit-together document or however else you plan to export it) and re-export it periodically as you go through fine-tuning.</p>
<p>This is also, probably, the most important part of this chapter. You will have to get every plot that you publish out of <code>R</code> somehow, after all!</p>
<div id="ggsave" class="section level3 unnumbered hasAnchor">
<h3>Exporting Images with <code>ggsave()</code><a href="fine-tuning-publication-quality-ggplots.html#ggsave" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You can, as we’ve already discussed, save a <code>ggplot</code> object in a <code>.rds</code> file. But that won’t let you put it into your powerpoint, or manuscript, or take it to the printer. You need an image file. The exact <em>type</em> of image will depend on the other software you’re using for your report, presentation, paper, book, etc.</p>
<p>The easiest way to reproducibly save plots, so that all of your export options are in your code and you might be able to recreate it on a different computer, is with the function <code>ggplot2::ggsave()</code>, which works <em>similarly</em> to the <code>write_*()</code> functions and <code>save()</code>. You give it a file name to save to, relative to the current working directory, and then the variable that has your ggplot.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="fine-tuning-publication-quality-ggplots.html#cb42-1" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;img/penalty-lift.jpeg&quot;</span>, p1_berry_penalty)</span></code></pre></div>
<p>We saved our image as a JPEG file, because JPEG is one of the formats preferred by <a href="https://www.sciencedirect.com/journal/food-quality-and-preference/publish/guide-for-authors#toc-51">Food Quality and Preference</a>. <code>ggsave()</code> supports a wide variety of image formats and will automatically use the file type corresponding to the file extension (the stuff after the <code>.</code>) in the <code>filename</code> argument.</p>
<p><img src="img/penalty-lift.jpeg" width="672px" style="display: block; margin: auto;" /></p>
<p>Note that <code>ggsave()</code> is like making a <code>.pdf</code> version of your working documents: you will not be able to read the plot images into <code>R</code> for editing anymore, no matter which format you save in.</p>
<p>We can also specify the <code>width</code> and <code>height</code> of our plot in inches, centimeters, or several other possible <code>units</code>. Aside from the <strong>aspect ratio</strong> of height to width, the size also affects how large various elements <em>look</em>, since <code>geom_*()</code> and text sizes are ultimately defined as fractions of inches.</p>
<p>Start by exporting your file at different <code>width</code> and <code>height</code> combinations until it looks legible, with readable text and other elements.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="fine-tuning-publication-quality-ggplots.html#cb43-1" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;img/penalty-lift-10x6.jpeg&quot;</span>, p1_berry_penalty,</span>
<span id="cb43-2"><a href="fine-tuning-publication-quality-ggplots.html#cb43-2" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">10</span>,</span>
<span id="cb43-3"><a href="fine-tuning-publication-quality-ggplots.html#cb43-3" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">6</span>,</span>
<span id="cb43-4"><a href="fine-tuning-publication-quality-ggplots.html#cb43-4" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>) <span class="co">#inches</span></span></code></pre></div>
<p><img src="img/penalty-lift-10x6.jpeg" width="672px" style="display: block; margin: auto;" /></p>
<p>And then figure out the <code>dpi</code>, or number of dots per inch, needed to have a file that will print well. <em>Do not</em> just use the DPI you want to print at, especially if you’re planning to use an image for a poster.</p>
<p>The FQAP Guide for Authors also tells us that it wants “combination figures”, which will include most graphs, at or above 500 dpi. A double column figure is about 7.5 inches or 190mm wide, so we need the image to be <span class="math inline">\(7.5 \times 500 = 3750\)</span> pixels wide. Since our nice plot had <code>width = 10</code>, we’ll set the <code>dpi</code> so that <span class="math inline">\(height \times dpi \geq 3750\)</span>.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="fine-tuning-publication-quality-ggplots.html#cb44-1" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;img/penalty-lift-double-column-width.jpeg&quot;</span>, p1_berry_penalty,</span>
<span id="cb44-2"><a href="fine-tuning-publication-quality-ggplots.html#cb44-2" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">10</span>,</span>
<span id="cb44-3"><a href="fine-tuning-publication-quality-ggplots.html#cb44-3" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">6</span>,</span>
<span id="cb44-4"><a href="fine-tuning-publication-quality-ggplots.html#cb44-4" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>, <span class="co">#inches</span></span>
<span id="cb44-5"><a href="fine-tuning-publication-quality-ggplots.html#cb44-5" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">400</span>) <span class="co">#slightly above 3750 / 10. Always err on the side of slightly too big!!</span></span></code></pre></div>
<p><img src="img/penalty-lift-double-column-width.jpeg" width="672px" style="display: block; margin: auto;" /></p>
<p>We go into a lot more detail on common file types and image resolution math in the <a href="appendix.html#ggformat">Appendix</a>.</p>
</div>
</div>
<div id="fine-tuning-bar-plots-facets-with-different-categorical-variables" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Fine-tuning bar plots &amp; facets with different categorical variables<a href="fine-tuning-publication-quality-ggplots.html#fine-tuning-bar-plots-facets-with-different-categorical-variables" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We’ll start with the penalty analysis plot.</p>
<p><code>p1_berry_penalty</code> uses some tricks from the <code>stringr</code> and <code>tidytext</code> packages in order to give us easy-to-read labels. Using the existing column names and variable-codes in our original data to make a first draft of a plot, it would’ve looked more like this:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="fine-tuning-publication-quality-ggplots.html#cb45-1" tabindex="-1"></a>berry_penalty_analysis_data <span class="sc">%&gt;%</span></span>
<span id="cb45-2"><a href="fine-tuning-publication-quality-ggplots.html#cb45-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cata_variable, <span class="at">y =</span> penalty_lift)) <span class="sc">+</span></span>
<span id="cb45-3"><a href="fine-tuning-publication-quality-ggplots.html#cb45-3" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> penalty_lift), <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb45-4"><a href="fine-tuning-publication-quality-ggplots.html#cb45-4" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>berry) <span class="sc">+</span></span>
<span id="cb45-5"><a href="fine-tuning-publication-quality-ggplots.html#cb45-5" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb45-6"><a href="fine-tuning-publication-quality-ggplots.html#cb45-6" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>))</span></code></pre></div>
<p><img src="03-finetuning-ggplot_files/figure-html/worse%20berry%20penalty%20analysis%20example-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Which we’re showing because we have seen similar plots published in journal articles, with the difficult-to-read axes, underscores, redundant axis labels, and all. We can make this more readable by reordering the CATA attributes, shortening and reformatting the labels, and possibly by removing some extraneous elements like the <code>cata_variable</code> label. These are common steps that make a huge difference.</p>
<div id="horizontal-text-with-coord_flip" class="section level3 hasAnchor" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Horizontal text with coord_flip()<a href="fine-tuning-publication-quality-ggplots.html#horizontal-text-with-coord_flip" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We’ve used <code>coord_flip()</code> a few times already, and it’s pretty straightforward to use–you just have to add it to a <code>ggplot()</code> call and it’ll make your <code>x</code> axis the vertical axis and your <code>y</code> axis the horizontal.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="fine-tuning-publication-quality-ggplots.html#cb46-1" tabindex="-1"></a>berry_penalty_analysis_data <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="fine-tuning-publication-quality-ggplots.html#cb46-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cata_variable, <span class="at">y =</span> penalty_lift)) <span class="sc">+</span></span>
<span id="cb46-3"><a href="fine-tuning-publication-quality-ggplots.html#cb46-3" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> penalty_lift), <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb46-4"><a href="fine-tuning-publication-quality-ggplots.html#cb46-4" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>berry, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb46-5"><a href="fine-tuning-publication-quality-ggplots.html#cb46-5" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb46-6"><a href="fine-tuning-publication-quality-ggplots.html#cb46-6" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="03-finetuning-ggplot_files/figure-html/coord_flip-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Even though the CATA attributes are still cramped and this isn’t the best use of space, they’re much easier to read now. If you’ve only got one categorical axis, it’s almost always going to be more readable to have it be the <em>vertical axis</em> so that the text is horizontal.</p>
</div>
<div id="ordered-categorical-variables" class="section level3 hasAnchor" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Ordered Categorical Variables<a href="fine-tuning-publication-quality-ggplots.html#ordered-categorical-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Many of the figures we’ve made so far have had an axis with a categorical variable. Have you figured out how <code>ggplot2</code> orders the levels of categorical variables? If you have noticed, it’s likely because it’s in a different order than the one we’d like.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="fine-tuning-publication-quality-ggplots.html#cb47-1" tabindex="-1"></a>berry_penalty_analysis_data <span class="sc">%&gt;%</span></span>
<span id="cb47-2"><a href="fine-tuning-publication-quality-ggplots.html#cb47-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cata_variable, <span class="at">y =</span> penalty_lift)) <span class="sc">+</span></span>
<span id="cb47-3"><a href="fine-tuning-publication-quality-ggplots.html#cb47-3" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> penalty_lift), <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb47-4"><a href="fine-tuning-publication-quality-ggplots.html#cb47-4" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>berry, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb47-5"><a href="fine-tuning-publication-quality-ggplots.html#cb47-5" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb47-6"><a href="fine-tuning-publication-quality-ggplots.html#cb47-6" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="03-finetuning-ggplot_files/figure-html/default%20categorical%20axis%20in%20ggplot2-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The CATA attributes are in alphabetical order (with the start of the alphabet the closest to 0). This is how <code>ggplot2</code> treats all <code>character</code> variables, and you can exert some control over the ordering by turning the variable into an ordered <code>factor</code>.</p>
<div id="specifying-ordinal-variables-as-factors" class="section level4 hasAnchor" number="3.2.2.1">
<h4><span class="header-section-number">3.2.2.1</span> Specifying Ordinal Variables as Factors<a href="fine-tuning-publication-quality-ggplots.html#specifying-ordinal-variables-as-factors" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>You can order variables by hand, if there’s a particular order you have in mind:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="fine-tuning-publication-quality-ggplots.html#cb48-1" tabindex="-1"></a>berry_penalty_analysis_data <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="fine-tuning-publication-quality-ggplots.html#cb48-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(cata_variable, <span class="st">&quot;taste&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="fine-tuning-publication-quality-ggplots.html#cb48-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cata_variable =</span> <span class="fu">factor</span>(cata_variable,</span>
<span id="cb48-4"><a href="fine-tuning-publication-quality-ggplots.html#cb48-4" tabindex="-1"></a>                                <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;taste_fruity&quot;</span>,</span>
<span id="cb48-5"><a href="fine-tuning-publication-quality-ggplots.html#cb48-5" tabindex="-1"></a>                                           <span class="st">&quot;taste_melon&quot;</span>, <span class="st">&quot;taste_peachy&quot;</span>, <span class="st">&quot;taste_grapey&quot;</span>, <span class="st">&quot;taste_grape&quot;</span>,</span>
<span id="cb48-6"><a href="fine-tuning-publication-quality-ggplots.html#cb48-6" tabindex="-1"></a>                                           <span class="st">&quot;taste_berry&quot;</span>, <span class="st">&quot;taste_cherry&quot;</span>,</span>
<span id="cb48-7"><a href="fine-tuning-publication-quality-ggplots.html#cb48-7" tabindex="-1"></a>                                           <span class="st">&quot;taste_citrus&quot;</span>, <span class="st">&quot;taste_lemon&quot;</span>,</span>
<span id="cb48-8"><a href="fine-tuning-publication-quality-ggplots.html#cb48-8" tabindex="-1"></a>                                           <span class="st">&quot;taste_tropical&quot;</span>,</span>
<span id="cb48-9"><a href="fine-tuning-publication-quality-ggplots.html#cb48-9" tabindex="-1"></a>                                           <span class="st">&quot;taste_candy&quot;</span>, <span class="st">&quot;taste_caramel&quot;</span>,</span>
<span id="cb48-10"><a href="fine-tuning-publication-quality-ggplots.html#cb48-10" tabindex="-1"></a>                                           <span class="st">&quot;taste_green&quot;</span>, <span class="st">&quot;taste_grassy&quot;</span>, <span class="st">&quot;taste_piney&quot;</span>, <span class="st">&quot;taste_minty&quot;</span>,</span>
<span id="cb48-11"><a href="fine-tuning-publication-quality-ggplots.html#cb48-11" tabindex="-1"></a>                                           <span class="st">&quot;taste_earthy&quot;</span>, <span class="st">&quot;taste_fermented&quot;</span>,</span>
<span id="cb48-12"><a href="fine-tuning-publication-quality-ggplots.html#cb48-12" tabindex="-1"></a>                                           <span class="st">&quot;taste_cinnamon&quot;</span>, <span class="st">&quot;taste_clove&quot;</span>,</span>
<span id="cb48-13"><a href="fine-tuning-publication-quality-ggplots.html#cb48-13" tabindex="-1"></a>                                           <span class="st">&quot;taste_floral&quot;</span>,</span>
<span id="cb48-14"><a href="fine-tuning-publication-quality-ggplots.html#cb48-14" tabindex="-1"></a>                                           <span class="st">&quot;taste_none&quot;</span>))) <span class="ot">-&gt;</span> berry_penalty_manual_factors</span>
<span id="cb48-15"><a href="fine-tuning-publication-quality-ggplots.html#cb48-15" tabindex="-1"></a></span>
<span id="cb48-16"><a href="fine-tuning-publication-quality-ggplots.html#cb48-16" tabindex="-1"></a>berry_penalty_manual_factors <span class="sc">%&gt;%</span></span>
<span id="cb48-17"><a href="fine-tuning-publication-quality-ggplots.html#cb48-17" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cata_variable, <span class="at">y =</span> penalty_lift)) <span class="sc">+</span></span>
<span id="cb48-18"><a href="fine-tuning-publication-quality-ggplots.html#cb48-18" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> penalty_lift), <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb48-19"><a href="fine-tuning-publication-quality-ggplots.html#cb48-19" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>berry, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb48-20"><a href="fine-tuning-publication-quality-ggplots.html#cb48-20" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb48-21"><a href="fine-tuning-publication-quality-ggplots.html#cb48-21" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="03-finetuning-ggplot_files/figure-html/manually%20making%20ordered%20factors-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Note that the attribute you list <em>first</em> when you’re specifying the <code>levels</code> will become 1, then 2, then 3. With <code>coord_flip()</code>, that puts it at the bottom of the plot.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="fine-tuning-publication-quality-ggplots.html#cb49-1" tabindex="-1"></a>berry_penalty_manual_factors <span class="sc">%&gt;%</span></span>
<span id="cb49-2"><a href="fine-tuning-publication-quality-ggplots.html#cb49-2" tabindex="-1"></a>  <span class="fu">distinct</span>(cata_variable) <span class="sc">%&gt;%</span></span>
<span id="cb49-3"><a href="fine-tuning-publication-quality-ggplots.html#cb49-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable_number =</span> <span class="fu">as.numeric</span>(cata_variable))</span></code></pre></div>
<pre><code>## # A tibble: 22 × 2
##    cata_variable   variable_number
##    &lt;fct&gt;                     &lt;dbl&gt;
##  1 taste_berry                   6
##  2 taste_cinnamon               19
##  3 taste_clove                  20
##  4 taste_earthy                 17
##  5 taste_fermented              18
##  6 taste_floral                 21
##  7 taste_fruity                  1
##  8 taste_grape                   5
##  9 taste_grassy                 14
## 10 taste_lemon                   9
## # ℹ 12 more rows</code></pre>
<p>This gives us control, but it’s pretty annoying to write out for large lists of attributes, and you have to be sure the spelling and capitalization match exactly. Often, like with the penalty analysis plots, what we actually want to do is order the Attributes in terms of some other numerical variable, like frequency or size of penalty.</p>
<p>One way is to <code>arrange()</code> the data the way you want it and then use that order to specify the levels.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="fine-tuning-publication-quality-ggplots.html#cb51-1" tabindex="-1"></a>berry_penalty_analysis_data <span class="sc">%&gt;%</span></span>
<span id="cb51-2"><a href="fine-tuning-publication-quality-ggplots.html#cb51-2" tabindex="-1"></a>  <span class="co"># Counting the number of times each attribute is used across all products:</span></span>
<span id="cb51-3"><a href="fine-tuning-publication-quality-ggplots.html#cb51-3" tabindex="-1"></a>  <span class="fu">group_by</span>(cata_variable) <span class="sc">%&gt;%</span></span>
<span id="cb51-4"><a href="fine-tuning-publication-quality-ggplots.html#cb51-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable_count =</span> <span class="fu">sum</span>(count)) <span class="sc">%&gt;%</span></span>
<span id="cb51-5"><a href="fine-tuning-publication-quality-ggplots.html#cb51-5" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb51-6"><a href="fine-tuning-publication-quality-ggplots.html#cb51-6" tabindex="-1"></a>  <span class="co"># Arranging from least-to-most used:</span></span>
<span id="cb51-7"><a href="fine-tuning-publication-quality-ggplots.html#cb51-7" tabindex="-1"></a>  <span class="fu">arrange</span>(variable_count) <span class="sc">%&gt;%</span></span>
<span id="cb51-8"><a href="fine-tuning-publication-quality-ggplots.html#cb51-8" tabindex="-1"></a>  <span class="co"># Converting to a factor, so the least-used will be 1st, then the next:</span></span>
<span id="cb51-9"><a href="fine-tuning-publication-quality-ggplots.html#cb51-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cata_variable =</span> <span class="fu">factor</span>(cata_variable, <span class="at">levels =</span> <span class="fu">unique</span>(cata_variable),</span>
<span id="cb51-10"><a href="fine-tuning-publication-quality-ggplots.html#cb51-10" tabindex="-1"></a>                            <span class="at">ordered =</span> <span class="cn">TRUE</span>),</span>
<span id="cb51-11"><a href="fine-tuning-publication-quality-ggplots.html#cb51-11" tabindex="-1"></a>         <span class="at">variable_number =</span> <span class="fu">as.numeric</span>(cata_variable)) <span class="ot">-&gt;</span> berry_penalty_frequency_factors</span>
<span id="cb51-12"><a href="fine-tuning-publication-quality-ggplots.html#cb51-12" tabindex="-1"></a></span>
<span id="cb51-13"><a href="fine-tuning-publication-quality-ggplots.html#cb51-13" tabindex="-1"></a><span class="co">#Now the plot:</span></span>
<span id="cb51-14"><a href="fine-tuning-publication-quality-ggplots.html#cb51-14" tabindex="-1"></a>berry_penalty_frequency_factors <span class="sc">%&gt;%</span></span>
<span id="cb51-15"><a href="fine-tuning-publication-quality-ggplots.html#cb51-15" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cata_variable, <span class="at">y =</span> penalty_lift)) <span class="sc">+</span></span>
<span id="cb51-16"><a href="fine-tuning-publication-quality-ggplots.html#cb51-16" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> penalty_lift), <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb51-17"><a href="fine-tuning-publication-quality-ggplots.html#cb51-17" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>berry, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb51-18"><a href="fine-tuning-publication-quality-ggplots.html#cb51-18" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb51-19"><a href="fine-tuning-publication-quality-ggplots.html#cb51-19" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="03-finetuning-ggplot_files/figure-html/using%20another%20variable%20to%20order%20a%20factor-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="facets-with-different-category-orders" class="section level4 hasAnchor" number="3.2.2.2">
<h4><span class="header-section-number">3.2.2.2</span> Facets with Different Category-Orders<a href="fine-tuning-publication-quality-ggplots.html#facets-with-different-category-orders" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>You’ll notice that our reordered categorical axes still have the same order across all of the plots. This would be true even if we used the within-product sums already in the <code>count</code> column to calculate <code>level</code>s. The order is based on factor levels, which are fixed within each column: <code>Fresh_Apples</code> can’t be “more than” <code>Dry</code> in one part of the <code>cata_variable</code> column and “less than” in another part.</p>
<p>On its own, <code>facet_wrap(..., scales = "free")</code> can drop unneeded attributes from plots, but it will still keep the same <em>order</em> of the attributes across all axes.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="fine-tuning-publication-quality-ggplots.html#cb52-1" tabindex="-1"></a>berry_penalty_frequency_factors <span class="sc">%&gt;%</span></span>
<span id="cb52-2"><a href="fine-tuning-publication-quality-ggplots.html#cb52-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cata_variable, <span class="at">y =</span> penalty_lift)) <span class="sc">+</span></span>
<span id="cb52-3"><a href="fine-tuning-publication-quality-ggplots.html#cb52-3" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> penalty_lift), <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb52-4"><a href="fine-tuning-publication-quality-ggplots.html#cb52-4" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>berry, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb52-5"><a href="fine-tuning-publication-quality-ggplots.html#cb52-5" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb52-6"><a href="fine-tuning-publication-quality-ggplots.html#cb52-6" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="03-finetuning-ggplot_files/figure-html/free%20scales%20on%20ordered%20data-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>If you have a faceted plot and you want each facet to have a different ordering of the terms, like in our big penalty analysis example, you’ll have to use <code>tidytext::reorder_within()</code>, <code>tidytext::scale_*_reordered()</code>, <em>and</em> <code>facet_wrap(..., scales = "free")</code>, all at once:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="fine-tuning-publication-quality-ggplots.html#cb53-1" tabindex="-1"></a>berry_penalty_analysis_data <span class="sc">%&gt;%</span></span>
<span id="cb53-2"><a href="fine-tuning-publication-quality-ggplots.html#cb53-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cata_variable_clean =</span> tidytext<span class="sc">::</span><span class="fu">reorder_within</span>(cata_variable_clean,</span>
<span id="cb53-3"><a href="fine-tuning-publication-quality-ggplots.html#cb53-3" tabindex="-1"></a>                                                  <span class="at">by =</span> count,</span>
<span id="cb53-4"><a href="fine-tuning-publication-quality-ggplots.html#cb53-4" tabindex="-1"></a>                                                  <span class="at">within =</span> berry)) <span class="sc">%&gt;%</span></span>
<span id="cb53-5"><a href="fine-tuning-publication-quality-ggplots.html#cb53-5" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cata_variable_clean, <span class="at">y =</span> penalty_lift)) <span class="sc">+</span></span>
<span id="cb53-6"><a href="fine-tuning-publication-quality-ggplots.html#cb53-6" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> penalty_lift), <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb53-7"><a href="fine-tuning-publication-quality-ggplots.html#cb53-7" tabindex="-1"></a>  tidytext<span class="sc">::</span><span class="fu">scale_x_reordered</span>() <span class="sc">+</span></span>
<span id="cb53-8"><a href="fine-tuning-publication-quality-ggplots.html#cb53-8" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>berry, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb53-9"><a href="fine-tuning-publication-quality-ggplots.html#cb53-9" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb53-10"><a href="fine-tuning-publication-quality-ggplots.html#cb53-10" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="03-finetuning-ggplot_files/figure-html/tidytext%20reordering%20within%20facets-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="making-labels-look-okay-powerful-text-manipulation-with-stringr" class="section level3 hasAnchor" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> Making labels look okay: Powerful text manipulation with <code>stringr</code><a href="fine-tuning-publication-quality-ggplots.html#making-labels-look-okay-powerful-text-manipulation-with-stringr" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A good <code>R</code> variable or column name doesn’t have any spaces or punctuation other than underscores (<code>_</code>) and dots (<code>.</code>), to avoid all those pesky backticks (```) in our code.</p>
<p>This is very different from what a good label in a plot looks like. You’ll often want to make some sort of mass changes to column names or text variables before plotting, in order to address this.</p>
<p>The <code>stringr</code> package is a part of the <code>tidyverse</code>, so you have it already loaded whenever you run <code>library(tidyverse)</code>. It has a lot of useful functions for working with text (called “<strong>str</strong>ings” in many programming languages), mostly of the form <code>str_*()</code>. One thing you can do is change labels to uppercase, lowercase, “sentence case”, or “title case” (first letter of each word capitalized), as appropriate:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="fine-tuning-publication-quality-ggplots.html#cb54-1" tabindex="-1"></a>berry_penalty_analysis_data <span class="sc">%&gt;%</span></span>
<span id="cb54-2"><a href="fine-tuning-publication-quality-ggplots.html#cb54-2" tabindex="-1"></a>  <span class="fu">select</span>(berry) <span class="sc">%&gt;%</span></span>
<span id="cb54-3"><a href="fine-tuning-publication-quality-ggplots.html#cb54-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Upper =</span> <span class="fu">str_to_upper</span>(berry),</span>
<span id="cb54-4"><a href="fine-tuning-publication-quality-ggplots.html#cb54-4" tabindex="-1"></a>         <span class="at">Title =</span> <span class="fu">str_to_title</span>(berry)) <span class="co"># Capitalizes the first letter of each word</span></span></code></pre></div>
<pre><code>## # A tibble: 85 × 3
##    berry      Upper      Title     
##    &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;     
##  1 blackberry BLACKBERRY Blackberry
##  2 blackberry BLACKBERRY Blackberry
##  3 blackberry BLACKBERRY Blackberry
##  4 blackberry BLACKBERRY Blackberry
##  5 blackberry BLACKBERRY Blackberry
##  6 blackberry BLACKBERRY Blackberry
##  7 blackberry BLACKBERRY Blackberry
##  8 blackberry BLACKBERRY Blackberry
##  9 blackberry BLACKBERRY Blackberry
## 10 blackberry BLACKBERRY Blackberry
## # ℹ 75 more rows</code></pre>
<div id="replacing-text" class="section level4 hasAnchor" number="3.2.3.1">
<h4><span class="header-section-number">3.2.3.1</span> Replacing text<a href="fine-tuning-publication-quality-ggplots.html#replacing-text" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>str_replace()</code> and <code>str_replace_all()</code> are very useful for dealing with underscores or periods. You give it <code>string</code>, the text vector you want to modify (inside <code>mutate()</code>, a column name); then <code>pattern</code>, the character(s) you want to replace; then <code>replacement</code>, what you want to replace them with.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="fine-tuning-publication-quality-ggplots.html#cb56-1" tabindex="-1"></a>berry_penalty_analysis_data <span class="sc">%&gt;%</span></span>
<span id="cb56-2"><a href="fine-tuning-publication-quality-ggplots.html#cb56-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cata_variable =</span> <span class="fu">str_replace_all</span>(cata_variable, <span class="st">&quot;_&quot;</span>, <span class="st">&quot;: &quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 85 × 5
##    berry      cata_variable           cata_variable_clean penalty_lift count
##    &lt;chr&gt;      &lt;chr&gt;                   &lt;chr&gt;                      &lt;dbl&gt; &lt;int&gt;
##  1 blackberry appearance: fresh       fresh (A)                  1.10    977
##  2 blackberry appearance: goodcolor   goodcolor (A)              1.14   1037
##  3 blackberry appearance: goodquality goodquality (A)            1.26    859
##  4 blackberry appearance: goodshapre  goodshapre (A)             0.923   787
##  5 blackberry appearance: misshapen   misshapen (A)             -0.708   447
##  6 blackberry appearance: none        none (A)                  -0.641    13
##  7 blackberry appearance: notfresh    notfresh (A)              -1.81    127
##  8 blackberry appearance: unevencolor unevencolor (A)           -0.998   163
##  9 blackberry appearane: bruised      bruised (A)               -0.861   190
## 10 blackberry taste: berry            berry (T)                  2.27    793
## # ℹ 75 more rows</code></pre>
<p>They can both be as long as you like. If <code>pattern = _</code> and there’s more than one <code>_</code> in one of the <code>string</code>s, <code>str_replace()</code> will only replace the first one and <code>str_replace_all()</code> will replace them all.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="fine-tuning-publication-quality-ggplots.html#cb58-1" tabindex="-1"></a><span class="fu">str_replace</span>(<span class="st">&quot;long_text_with_many_underscores&quot;</span>, <span class="st">&quot;_&quot;</span>, <span class="st">&quot; &quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;long text_with_many_underscores&quot;</code></pre>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="fine-tuning-publication-quality-ggplots.html#cb60-1" tabindex="-1"></a><span class="fu">str_replace_all</span>(<span class="st">&quot;long_text_with_many_underscores&quot;</span>, <span class="st">&quot;_&quot;</span>, <span class="st">&quot; &quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;long text with many underscores&quot;</code></pre>
<p>You can add multiple sets of <code>pattern</code>s and <code>replace</code>ments to <code>str_replace_all()</code> using a named list: <code>c("pattern1" = "replace1", "pattern2" = "replace2"</code>. This is useful to, for instance, fix multiple typos like “goodshapre”. Unlike the <code>case_when()</code> example we showed before, you can fix typos that occur anywhere in the text, even if they’re only parts of a word.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="fine-tuning-publication-quality-ggplots.html#cb62-1" tabindex="-1"></a>berry_penalty_analysis_data <span class="sc">%&gt;%</span></span>
<span id="cb62-2"><a href="fine-tuning-publication-quality-ggplots.html#cb62-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cata_variable =</span> <span class="fu">str_replace_all</span>(cata_variable,</span>
<span id="cb62-3"><a href="fine-tuning-publication-quality-ggplots.html#cb62-3" tabindex="-1"></a>                                         <span class="fu">c</span>(<span class="st">&quot;shapre&quot;</span> <span class="ot">=</span> <span class="st">&quot;shape&quot;</span>,</span>
<span id="cb62-4"><a href="fine-tuning-publication-quality-ggplots.html#cb62-4" tabindex="-1"></a>                                           <span class="st">&quot;appearane&quot;</span> <span class="ot">=</span> <span class="st">&quot;appearance&quot;</span>,</span>
<span id="cb62-5"><a href="fine-tuning-publication-quality-ggplots.html#cb62-5" tabindex="-1"></a>                                           <span class="st">&quot;_&quot;</span> <span class="ot">=</span> <span class="st">&quot; &quot;</span>)))</span></code></pre></div>
<pre><code>## # A tibble: 85 × 5
##    berry      cata_variable          cata_variable_clean penalty_lift count
##    &lt;chr&gt;      &lt;chr&gt;                  &lt;chr&gt;                      &lt;dbl&gt; &lt;int&gt;
##  1 blackberry appearance fresh       fresh (A)                  1.10    977
##  2 blackberry appearance goodcolor   goodcolor (A)              1.14   1037
##  3 blackberry appearance goodquality goodquality (A)            1.26    859
##  4 blackberry appearance goodshape   goodshapre (A)             0.923   787
##  5 blackberry appearance misshapen   misshapen (A)             -0.708   447
##  6 blackberry appearance none        none (A)                  -0.641    13
##  7 blackberry appearance notfresh    notfresh (A)              -1.81    127
##  8 blackberry appearance unevencolor unevencolor (A)           -0.998   163
##  9 blackberry appearance bruised     bruised (A)               -0.861   190
## 10 blackberry taste berry            berry (T)                  2.27    793
## # ℹ 75 more rows</code></pre>
<p>Be careful using short <code>pattern</code>s, because they will replace every example <em>even if it’s only part of a word</em>.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="fine-tuning-publication-quality-ggplots.html#cb64-1" tabindex="-1"></a><span class="co">#This can lead to unintentional side-effects</span></span>
<span id="cb64-2"><a href="fine-tuning-publication-quality-ggplots.html#cb64-2" tabindex="-1"></a><span class="fu">c</span>(<span class="st">&quot;nocolor&quot;</span>, <span class="st">&quot;none&quot;</span>, <span class="st">&quot;cornonthecob&quot;</span>, <span class="st">&quot;anode&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-3"><a href="fine-tuning-publication-quality-ggplots.html#cb64-3" tabindex="-1"></a>  <span class="fu">str_replace_all</span>(<span class="st">&quot;no&quot;</span>, <span class="st">&quot; NO &quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot; NO color&quot;      &quot; NO ne&quot;         &quot;cor NO nthecob&quot; &quot;a NO de&quot;</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="fine-tuning-publication-quality-ggplots.html#cb66-1" tabindex="-1"></a><span class="co">#Or it can be useful for fixing lots of similar problems all at once</span></span>
<span id="cb66-2"><a href="fine-tuning-publication-quality-ggplots.html#cb66-2" tabindex="-1"></a>berry_penalty_analysis_data <span class="sc">%&gt;%</span></span>
<span id="cb66-3"><a href="fine-tuning-publication-quality-ggplots.html#cb66-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cata_variable =</span> <span class="fu">str_replace_all</span>(cata_variable,</span>
<span id="cb66-4"><a href="fine-tuning-publication-quality-ggplots.html#cb66-4" tabindex="-1"></a>                                         <span class="fu">c</span>(<span class="st">&quot;not&quot;</span> <span class="ot">=</span> <span class="st">&quot;not &quot;</span>,</span>
<span id="cb66-5"><a href="fine-tuning-publication-quality-ggplots.html#cb66-5" tabindex="-1"></a>                                           <span class="st">&quot;good&quot;</span> <span class="ot">=</span> <span class="st">&quot;good &quot;</span>,</span>
<span id="cb66-6"><a href="fine-tuning-publication-quality-ggplots.html#cb66-6" tabindex="-1"></a>                                           <span class="st">&quot;uneven&quot;</span> <span class="ot">=</span> <span class="st">&quot;uneven &quot;</span>,</span>
<span id="cb66-7"><a href="fine-tuning-publication-quality-ggplots.html#cb66-7" tabindex="-1"></a>                                           <span class="st">&quot;_&quot;</span> <span class="ot">=</span> <span class="st">&quot; &quot;</span>)))</span></code></pre></div>
<pre><code>## # A tibble: 85 × 5
##    berry      cata_variable           cata_variable_clean penalty_lift count
##    &lt;chr&gt;      &lt;chr&gt;                   &lt;chr&gt;                      &lt;dbl&gt; &lt;int&gt;
##  1 blackberry appearance fresh        fresh (A)                  1.10    977
##  2 blackberry appearance good color   goodcolor (A)              1.14   1037
##  3 blackberry appearance good quality goodquality (A)            1.26    859
##  4 blackberry appearance good shapre  goodshapre (A)             0.923   787
##  5 blackberry appearance misshapen    misshapen (A)             -0.708   447
##  6 blackberry appearance none         none (A)                  -0.641    13
##  7 blackberry appearance not fresh    notfresh (A)              -1.81    127
##  8 blackberry appearance uneven color unevencolor (A)           -0.998   163
##  9 blackberry appearane bruised       bruised (A)               -0.861   190
## 10 blackberry taste berry             berry (T)                  2.27    793
## # ℹ 75 more rows</code></pre>
<p>So far, we’ve been replacing letters and underscores, which is what we have in our example data. You can also use <code>str_replace()</code> for periods (<code>.</code>), although you may be surprised when you first try:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="fine-tuning-publication-quality-ggplots.html#cb68-1" tabindex="-1"></a><span class="fu">str_replace_all</span>(<span class="st">&quot;long.text.with.many.periods&quot;</span>, <span class="st">&quot;.&quot;</span>, <span class="st">&quot; &quot;</span>) <span class="co"># Replaces everything</span></span></code></pre></div>
<pre><code>## [1] &quot;                           &quot;</code></pre>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="fine-tuning-publication-quality-ggplots.html#cb70-1" tabindex="-1"></a><span class="fu">str_replace_all</span>(<span class="st">&quot;long.text.with.many.periods&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.&quot;</span>, <span class="st">&quot; &quot;</span>) <span class="co"># Replaces only dots</span></span></code></pre></div>
<pre><code>## [1] &quot;long text with many periods&quot;</code></pre>
<p>We have to <strong>escape</strong> the period (with an escaped backslash, technically, but for now just know that you must put two backslashes <code>\\</code> before special characters when using <code>stringr</code>). Because the <code>str_*</code> functions with a <code>pattern</code> can use <strong>Regular Expressions</strong> (or regex), the characters (<code>\</code>, <code>.</code>, <code>[</code>, <code>]</code>, <code>{</code>, <code>}</code>, <code>(</code>, <code>)</code>, <code>&lt;</code>, <code>&gt;</code>, <code>*</code>, <code>+</code>, <code>-</code>, <code>=</code>, <code>!</code>, <code>?</code>, <code>^</code>, <code>$</code>, and <code>|</code>) need to be <strong>escaped</strong> with two backslashes if you need to replace them.</p>
<p>Regex are extremely powerful tools for finding patterns in text, similar to the intuitive ways a human might recognize something like an email address, a measurement, or a parenthetical. We will not be talking about regex today, but if you want to see some examples and resources for learning how to use them, we’ve provided a short overview and links to some resources in the <a href="appendix.html#regex">Appendix</a>.</p>
</div>
<div id="splitting-and-combining-text" class="section level4 hasAnchor" number="3.2.3.2">
<h4><span class="header-section-number">3.2.3.2</span> Splitting and combining text<a href="fine-tuning-publication-quality-ggplots.html#splitting-and-combining-text" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>It’s also very common that you may have variable names in one column which actually represent multiple variables, and may want to, say, color-code the modality of the cata variables so that appearance attributes are one color and taste attributes are another.</p>
<p>There are a few versions of the <code>tidyr::separate_wider_*()</code> function that can, for example, split the <code>cata_variable</code> column into two columns, one with everything <em>before</em> the <strong>delimiter</strong> (here, an underscore) and one with everything <em>after</em> the delimiter. Be very careful using <code>separate_wider_delim()</code> like this if some rows may have more underscores (or whatever your delimiter is) than others.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="fine-tuning-publication-quality-ggplots.html#cb72-1" tabindex="-1"></a>berry_penalty_by_modality <span class="ot">&lt;-</span> berry_penalty_analysis_data <span class="sc">%&gt;%</span></span>
<span id="cb72-2"><a href="fine-tuning-publication-quality-ggplots.html#cb72-2" tabindex="-1"></a>  <span class="fu">separate_wider_delim</span>(cata_variable, <span class="st">&quot;_&quot;</span>,</span>
<span id="cb72-3"><a href="fine-tuning-publication-quality-ggplots.html#cb72-3" tabindex="-1"></a>                       <span class="at">names =</span> <span class="fu">c</span>(<span class="st">&quot;mode&quot;</span>, <span class="st">&quot;variable&quot;</span>),</span>
<span id="cb72-4"><a href="fine-tuning-publication-quality-ggplots.html#cb72-4" tabindex="-1"></a>                       <span class="at">cols_remove =</span> <span class="cn">FALSE</span>)</span>
<span id="cb72-5"><a href="fine-tuning-publication-quality-ggplots.html#cb72-5" tabindex="-1"></a></span>
<span id="cb72-6"><a href="fine-tuning-publication-quality-ggplots.html#cb72-6" tabindex="-1"></a>berry_penalty_by_modality</span></code></pre></div>
<pre><code>## # A tibble: 85 × 7
##    berry     mode  variable cata_variable cata_variable_clean penalty_lift count
##    &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;         &lt;chr&gt;                      &lt;dbl&gt; &lt;int&gt;
##  1 blackber… appe… fresh    appearance_f… fresh (A)                  1.10    977
##  2 blackber… appe… goodcol… appearance_g… goodcolor (A)              1.14   1037
##  3 blackber… appe… goodqua… appearance_g… goodquality (A)            1.26    859
##  4 blackber… appe… goodsha… appearance_g… goodshapre (A)             0.923   787
##  5 blackber… appe… misshap… appearance_m… misshapen (A)             -0.708   447
##  6 blackber… appe… none     appearance_n… none (A)                  -0.641    13
##  7 blackber… appe… notfresh appearance_n… notfresh (A)              -1.81    127
##  8 blackber… appe… unevenc… appearance_u… unevencolor (A)           -0.998   163
##  9 blackber… appe… bruised  appearane_br… bruised (A)               -0.861   190
## 10 blackber… taste berry    taste_berry   berry (T)                  2.27    793
## # ℹ 75 more rows</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="fine-tuning-publication-quality-ggplots.html#cb74-1" tabindex="-1"></a><span class="co"># Which would let you easily color-code your ggplot based on the new mode column</span></span>
<span id="cb74-2"><a href="fine-tuning-publication-quality-ggplots.html#cb74-2" tabindex="-1"></a></span>
<span id="cb74-3"><a href="fine-tuning-publication-quality-ggplots.html#cb74-3" tabindex="-1"></a>berry_penalty_by_modality <span class="sc">%&gt;%</span></span>
<span id="cb74-4"><a href="fine-tuning-publication-quality-ggplots.html#cb74-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> cata_variable, <span class="at">y =</span> count, <span class="at">fill =</span> mode)) <span class="sc">+</span></span>
<span id="cb74-5"><a href="fine-tuning-publication-quality-ggplots.html#cb74-5" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb74-6"><a href="fine-tuning-publication-quality-ggplots.html#cb74-6" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="03-finetuning-ggplot_files/figure-html/using%20separate%20to%20split%20one%20text%20column%20into%20multiple-1.png" width="672" style="display: block; margin: auto;" />
(We’ll get to the typo in just a second–you already know how to fix it, though!)</p>
<p>If you want to put multiple columns of text <em>together</em>, you can use either <code>tidyr::unite()</code> or <code>stringr::str_c()</code> (string combine).</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="fine-tuning-publication-quality-ggplots.html#cb75-1" tabindex="-1"></a>berry_penalty_by_modality <span class="sc">%&gt;%</span></span>
<span id="cb75-2"><a href="fine-tuning-publication-quality-ggplots.html#cb75-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cata_variable_2 =</span> <span class="fu">str_c</span>(variable, mode, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb75-3"><a href="fine-tuning-publication-quality-ggplots.html#cb75-3" tabindex="-1"></a>  <span class="fu">unite</span>(variable, mode, <span class="at">col =</span> <span class="st">&quot;cata_variable_3&quot;</span>, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 85 × 7
##    berry    cata_variable_3 cata_variable cata_variable_clean penalty_lift count
##    &lt;chr&gt;    &lt;chr&gt;           &lt;chr&gt;         &lt;chr&gt;                      &lt;dbl&gt; &lt;int&gt;
##  1 blackbe… fresh appearan… appearance_f… fresh (A)                  1.10    977
##  2 blackbe… goodcolor appe… appearance_g… goodcolor (A)              1.14   1037
##  3 blackbe… goodquality ap… appearance_g… goodquality (A)            1.26    859
##  4 blackbe… goodshapre app… appearance_g… goodshapre (A)             0.923   787
##  5 blackbe… misshapen appe… appearance_m… misshapen (A)             -0.708   447
##  6 blackbe… none appearance appearance_n… none (A)                  -0.641    13
##  7 blackbe… notfresh appea… appearance_n… notfresh (A)              -1.81    127
##  8 blackbe… unevencolor ap… appearance_u… unevencolor (A)           -0.998   163
##  9 blackbe… bruised appear… appearane_br… bruised (A)               -0.861   190
## 10 blackbe… berry taste     taste_berry   berry (T)                  2.27    793
## # ℹ 75 more rows
## # ℹ 1 more variable: cata_variable_2 &lt;chr&gt;</code></pre>
<p>You may have noticed that <code>berry_penalty_analysis_data</code> has both <code>cata_variable</code> and <code>cata_variable_clean</code>, and that the latter is shorter, which fits better on the page. You now know all of the tricks that we used to get from one to the other:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="fine-tuning-publication-quality-ggplots.html#cb77-1" tabindex="-1"></a>berry_penalty_analysis_data <span class="sc">%&gt;%</span></span>
<span id="cb77-2"><a href="fine-tuning-publication-quality-ggplots.html#cb77-2" tabindex="-1"></a>  <span class="co"># Fixing typos</span></span>
<span id="cb77-3"><a href="fine-tuning-publication-quality-ggplots.html#cb77-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cata_variable =</span> <span class="fu">str_replace_all</span>(cata_variable, <span class="fu">c</span>(<span class="st">&quot;appearane&quot;</span> <span class="ot">=</span> <span class="st">&quot;appearance&quot;</span>,</span>
<span id="cb77-4"><a href="fine-tuning-publication-quality-ggplots.html#cb77-4" tabindex="-1"></a>                                                      <span class="st">&quot;shapre&quot;</span> <span class="ot">=</span> <span class="st">&quot;shape&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb77-5"><a href="fine-tuning-publication-quality-ggplots.html#cb77-5" tabindex="-1"></a>  <span class="co"># Separating the modality from the attribute name</span></span>
<span id="cb77-6"><a href="fine-tuning-publication-quality-ggplots.html#cb77-6" tabindex="-1"></a>  <span class="fu">separate_wider_delim</span>(cata_variable, <span class="st">&quot;_&quot;</span>,</span>
<span id="cb77-7"><a href="fine-tuning-publication-quality-ggplots.html#cb77-7" tabindex="-1"></a>                       <span class="at">names =</span> <span class="fu">c</span>(<span class="st">&quot;mode&quot;</span>, <span class="st">&quot;variable&quot;</span>),</span>
<span id="cb77-8"><a href="fine-tuning-publication-quality-ggplots.html#cb77-8" tabindex="-1"></a>                       <span class="at">cols_remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb77-9"><a href="fine-tuning-publication-quality-ggplots.html#cb77-9" tabindex="-1"></a>  <span class="co"># Shorthand for the taste and appearance variables</span></span>
<span id="cb77-10"><a href="fine-tuning-publication-quality-ggplots.html#cb77-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mode =</span> <span class="fu">case_when</span>(mode <span class="sc">==</span> <span class="st">&quot;taste&quot;</span> <span class="sc">~</span> <span class="st">&quot;(T)&quot;</span>,</span>
<span id="cb77-11"><a href="fine-tuning-publication-quality-ggplots.html#cb77-11" tabindex="-1"></a>                          mode <span class="sc">==</span> <span class="st">&quot;appearance&quot;</span> <span class="sc">~</span> <span class="st">&quot;(A)&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb77-12"><a href="fine-tuning-publication-quality-ggplots.html#cb77-12" tabindex="-1"></a>  <span class="co"># Putting them back together</span></span>
<span id="cb77-13"><a href="fine-tuning-publication-quality-ggplots.html#cb77-13" tabindex="-1"></a>  <span class="fu">unite</span>(variable, mode, <span class="at">col =</span> <span class="st">&quot;cata_variable_clean&quot;</span>, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 85 × 5
##    berry      cata_variable_clean cata_variable          penalty_lift count
##    &lt;chr&gt;      &lt;chr&gt;               &lt;chr&gt;                         &lt;dbl&gt; &lt;int&gt;
##  1 blackberry fresh (A)           appearance_fresh              1.10    977
##  2 blackberry goodcolor (A)       appearance_goodcolor          1.14   1037
##  3 blackberry goodquality (A)     appearance_goodquality        1.26    859
##  4 blackberry goodshape (A)       appearance_goodshape          0.923   787
##  5 blackberry misshapen (A)       appearance_misshapen         -0.708   447
##  6 blackberry none (A)            appearance_none              -0.641    13
##  7 blackberry notfresh (A)        appearance_notfresh          -1.81    127
##  8 blackberry unevencolor (A)     appearance_unevencolor       -0.998   163
##  9 blackberry bruised (A)         appearance_bruised           -0.861   190
## 10 blackberry berry (T)           taste_berry                   2.27    793
## # ℹ 75 more rows</code></pre>
</div>
</div>
<div id="removing-plot-elements" class="section level3 hasAnchor" number="3.2.4">
<h3><span class="header-section-number">3.2.4</span> Removing Plot Elements<a href="fine-tuning-publication-quality-ggplots.html#removing-plot-elements" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Plots are easiest to read when they have only the information that’s actually relevant, so some labels and other elements that <code>ggplot2</code> adds by default can end up being extraneous and distracting.</p>
<p>We covered using <code>theme()</code> to remove elements with <code>element_blank()</code> (e.g., <code>+ theme(panel.grid = element_blank())</code> to get rid of the grid lines), but there are some exceptions to this rule.</p>
<p>When we’re using <code>tidytext::reorder_within()</code> to order each individual facet from highest penalty to highest lift, any color-coding for the lift is redundant info and we don’t really need a legend to spell it out:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="fine-tuning-publication-quality-ggplots.html#cb79-1" tabindex="-1"></a>berry_penalty_analysis_data <span class="sc">%&gt;%</span></span>
<span id="cb79-2"><a href="fine-tuning-publication-quality-ggplots.html#cb79-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cata_variable_clean =</span> tidytext<span class="sc">::</span><span class="fu">reorder_within</span>(<span class="at">x =</span> cata_variable_clean,</span>
<span id="cb79-3"><a href="fine-tuning-publication-quality-ggplots.html#cb79-3" tabindex="-1"></a>                                                        <span class="at">by =</span> penalty_lift,</span>
<span id="cb79-4"><a href="fine-tuning-publication-quality-ggplots.html#cb79-4" tabindex="-1"></a>                                                        <span class="at">within =</span> berry)) <span class="sc">%&gt;%</span></span>
<span id="cb79-5"><a href="fine-tuning-publication-quality-ggplots.html#cb79-5" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cata_variable_clean, <span class="at">y =</span> penalty_lift)) <span class="sc">+</span></span>
<span id="cb79-6"><a href="fine-tuning-publication-quality-ggplots.html#cb79-6" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> penalty_lift), <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span> </span>
<span id="cb79-7"><a href="fine-tuning-publication-quality-ggplots.html#cb79-7" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>berry, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb79-8"><a href="fine-tuning-publication-quality-ggplots.html#cb79-8" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb79-9"><a href="fine-tuning-publication-quality-ggplots.html#cb79-9" tabindex="-1"></a>  tidytext<span class="sc">::</span><span class="fu">scale_x_reordered</span>()</span></code></pre></div>
<p><img src="03-finetuning-ggplot_files/figure-html/redundant%20legend-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>We also don’t really need the axis labels, since neither has units and anyone unfamiliar with a penalty-lift plot will need more explanation than an axis label can really provide, but <code>cata_variable_clean</code> is especially redundant.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="fine-tuning-publication-quality-ggplots.html#cb80-1" tabindex="-1"></a>berry_penalty_analysis_data <span class="sc">%&gt;%</span></span>
<span id="cb80-2"><a href="fine-tuning-publication-quality-ggplots.html#cb80-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cata_variable_clean =</span> tidytext<span class="sc">::</span><span class="fu">reorder_within</span>(<span class="at">x =</span> cata_variable_clean,</span>
<span id="cb80-3"><a href="fine-tuning-publication-quality-ggplots.html#cb80-3" tabindex="-1"></a>                                                        <span class="at">by =</span> penalty_lift,</span>
<span id="cb80-4"><a href="fine-tuning-publication-quality-ggplots.html#cb80-4" tabindex="-1"></a>                                                        <span class="at">within =</span> berry)) <span class="sc">%&gt;%</span></span>
<span id="cb80-5"><a href="fine-tuning-publication-quality-ggplots.html#cb80-5" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cata_variable_clean, <span class="at">y =</span> penalty_lift)) <span class="sc">+</span></span>
<span id="cb80-6"><a href="fine-tuning-publication-quality-ggplots.html#cb80-6" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> penalty_lift), <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span> </span>
<span id="cb80-7"><a href="fine-tuning-publication-quality-ggplots.html#cb80-7" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>berry, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb80-8"><a href="fine-tuning-publication-quality-ggplots.html#cb80-8" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb80-9"><a href="fine-tuning-publication-quality-ggplots.html#cb80-9" tabindex="-1"></a>  tidytext<span class="sc">::</span><span class="fu">scale_x_reordered</span>() <span class="sc">+</span></span>
<span id="cb80-10"><a href="fine-tuning-publication-quality-ggplots.html#cb80-10" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb80-11"><a href="fine-tuning-publication-quality-ggplots.html#cb80-11" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="03-finetuning-ggplot_files/figure-html/removing%20the%20legend-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>We can remove these both with one call to <code>theme()</code>, but the axis title is removed with <code>axis.title.y = element_blank()</code> and the legend is removed with <code>legend.position = "none"</code>. And, yes, that <em>is</em> <code>axis.title.y</code>, referring to the same <code>cata_variable_clean</code> axis that <code>scale_x_reordered()</code> is calling the x-axis.</p>
<p>Some <code>ggplot2</code> functions will always refer to whatever you specified in <code>aes(x = ...)</code> as the x-axis, while some will refer to the <em>horizontal</em> axis as the x-axis, meaning that <code>coord_flip()</code> can make things confusing. It’s not worth trying to memorize or find patterns–this is something you’ll have to tweak by trial and error.</p>
<p>Sometimes, there are multiple ways of removing a plot element, and whichever one you remember is fine to use. One notable example that may save you some typing is the <code>labs()</code> function, which lets you label the <code>x</code> and <code>y</code> axes, the whole plot <code>title</code>, and so on with a slightly easier-to-remember interface than <code>theme()</code>. Setting any of the <code>labs()</code> arguments <code>= NULL</code> will remove it from the plot.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="fine-tuning-publication-quality-ggplots.html#cb81-1" tabindex="-1"></a>berry_penalty_analysis_data <span class="sc">%&gt;%</span></span>
<span id="cb81-2"><a href="fine-tuning-publication-quality-ggplots.html#cb81-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cata_variable_clean =</span> tidytext<span class="sc">::</span><span class="fu">reorder_within</span>(<span class="at">x =</span> cata_variable_clean,</span>
<span id="cb81-3"><a href="fine-tuning-publication-quality-ggplots.html#cb81-3" tabindex="-1"></a>                                                        <span class="at">by =</span> penalty_lift,</span>
<span id="cb81-4"><a href="fine-tuning-publication-quality-ggplots.html#cb81-4" tabindex="-1"></a>                                                        <span class="at">within =</span> berry)) <span class="sc">%&gt;%</span></span>
<span id="cb81-5"><a href="fine-tuning-publication-quality-ggplots.html#cb81-5" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cata_variable_clean, <span class="at">y =</span> penalty_lift)) <span class="sc">+</span></span>
<span id="cb81-6"><a href="fine-tuning-publication-quality-ggplots.html#cb81-6" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> penalty_lift), <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span> </span>
<span id="cb81-7"><a href="fine-tuning-publication-quality-ggplots.html#cb81-7" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>berry, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb81-8"><a href="fine-tuning-publication-quality-ggplots.html#cb81-8" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb81-9"><a href="fine-tuning-publication-quality-ggplots.html#cb81-9" tabindex="-1"></a>  tidytext<span class="sc">::</span><span class="fu">scale_x_reordered</span>() <span class="sc">+</span></span>
<span id="cb81-10"><a href="fine-tuning-publication-quality-ggplots.html#cb81-10" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">&quot;Penalty&quot;</span>,</span>
<span id="cb81-11"><a href="fine-tuning-publication-quality-ggplots.html#cb81-11" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Penalty / Lift Analysis&quot;</span>,</span>
<span id="cb81-12"><a href="fine-tuning-publication-quality-ggplots.html#cb81-12" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;displays the mean difference (within berries) for when a CATA variable is checked&quot;</span>)</span></code></pre></div>
<p><img src="03-finetuning-ggplot_files/figure-html/removing%20axis%20labels-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Note that, unlike <code>theme()</code>, <code>labs(x = ...)</code> refers to the same <code>x</code> as <code>aes(x = ...)</code>.</p>
</div>
<div id="putting-it-all-together" class="section level3 hasAnchor" number="3.2.5">
<h3><span class="header-section-number">3.2.5</span> Putting it all together<a href="fine-tuning-publication-quality-ggplots.html#putting-it-all-together" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now, at long last, we’re ready to walk line-by-line through the example penalty analysis figure that we’ve just been copy-pasting so far in the workshop.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="fine-tuning-publication-quality-ggplots.html#cb82-1" tabindex="-1"></a>berry_penalty_analysis_data <span class="sc">%&gt;%</span></span>
<span id="cb82-2"><a href="fine-tuning-publication-quality-ggplots.html#cb82-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cata_variable_clean =</span> tidytext<span class="sc">::</span><span class="fu">reorder_within</span>(<span class="at">x =</span> cata_variable_clean,</span>
<span id="cb82-3"><a href="fine-tuning-publication-quality-ggplots.html#cb82-3" tabindex="-1"></a>                                                        <span class="at">by =</span> penalty_lift,</span>
<span id="cb82-4"><a href="fine-tuning-publication-quality-ggplots.html#cb82-4" tabindex="-1"></a>                                                        <span class="at">within =</span> berry)) <span class="sc">%&gt;%</span></span>
<span id="cb82-5"><a href="fine-tuning-publication-quality-ggplots.html#cb82-5" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cata_variable_clean, <span class="at">y =</span> penalty_lift)) <span class="sc">+</span></span>
<span id="cb82-6"><a href="fine-tuning-publication-quality-ggplots.html#cb82-6" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> penalty_lift), <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span> </span>
<span id="cb82-7"><a href="fine-tuning-publication-quality-ggplots.html#cb82-7" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>berry, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb82-8"><a href="fine-tuning-publication-quality-ggplots.html#cb82-8" tabindex="-1"></a>  tidytext<span class="sc">::</span><span class="fu">scale_x_reordered</span>() <span class="sc">+</span> </span>
<span id="cb82-9"><a href="fine-tuning-publication-quality-ggplots.html#cb82-9" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb82-10"><a href="fine-tuning-publication-quality-ggplots.html#cb82-10" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span> </span>
<span id="cb82-11"><a href="fine-tuning-publication-quality-ggplots.html#cb82-11" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">&quot;tan&quot;</span>, <span class="at">high =</span> <span class="st">&quot;darkgreen&quot;</span>) <span class="sc">+</span> </span>
<span id="cb82-12"><a href="fine-tuning-publication-quality-ggplots.html#cb82-12" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Penalty / Lift Analysis&quot;</span>,</span>
<span id="cb82-13"><a href="fine-tuning-publication-quality-ggplots.html#cb82-13" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;displays the mean difference (within berries) for when a CATA variable is checked&quot;</span>) <span class="sc">+</span></span>
<span id="cb82-14"><a href="fine-tuning-publication-quality-ggplots.html#cb82-14" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb82-15"><a href="fine-tuning-publication-quality-ggplots.html#cb82-15" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="03-finetuning-ggplot_files/figure-html/final%20walkthrough%20of%20penalty%20analysis-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="fine-tuning-biplots-with-different-types-of-variables" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Fine-tuning biplots with different types of variables<a href="fine-tuning-publication-quality-ggplots.html#fine-tuning-biplots-with-different-types-of-variables" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><code>p2_ca_cider_cata</code> has a lot of different aesthetics, some of . Using the existing column names and variable-codes in our original data to make a first draft of a plot, it would’ve looked more like this:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="fine-tuning-publication-quality-ggplots.html#cb83-1" tabindex="-1"></a>draft_cider_plot <span class="ot">&lt;-</span> ca_cider_coords <span class="sc">%&gt;%</span></span>
<span id="cb83-2"><a href="fine-tuning-publication-quality-ggplots.html#cb83-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Dim 1</span><span class="st">`</span>, <span class="at">y =</span> <span class="st">`</span><span class="at">Dim 2</span><span class="st">`</span>, <span class="at">color =</span> type)) <span class="sc">+</span> </span>
<span id="cb83-3"><a href="fine-tuning-publication-quality-ggplots.html#cb83-3" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb83-4"><a href="fine-tuning-publication-quality-ggplots.html#cb83-4" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">label =</span> name)) <span class="sc">+</span></span>
<span id="cb83-5"><a href="fine-tuning-publication-quality-ggplots.html#cb83-5" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb83-6"><a href="fine-tuning-publication-quality-ggplots.html#cb83-6" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;darkorange&quot;</span>, <span class="st">&quot;darkgreen&quot;</span>))</span>
<span id="cb83-7"><a href="fine-tuning-publication-quality-ggplots.html#cb83-7" tabindex="-1"></a></span>
<span id="cb83-8"><a href="fine-tuning-publication-quality-ggplots.html#cb83-8" tabindex="-1"></a>draft_cider_plot</span></code></pre></div>
<p><img src="03-finetuning-ggplot_files/figure-html/worse%20cider%20CA%20example-1.png" width="672" style="display: block; margin: auto;" /></p>
<div id="axis-and-plot-labels-based-on-variables" class="section level3 hasAnchor" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Axis and plot labels based on variables<a href="fine-tuning-publication-quality-ggplots.html#axis-and-plot-labels-based-on-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>FactoMineR</code> plot we briefly showed in <a href="importing-and-wrangling-data.html#pubquality">Chapter 1</a> included the percentage of inertia explained by each dimension <em>in the axis labels</em>, which is extremely nice, even though it’s difficult to adjust the <code>FactoMineR</code> plot directly.</p>
<p>The <code>FactoMineR::CA()</code> function gives us all of the information we need to add this to our ggplot, and in our data set it’s saved in the <code>ca_cider$eig</code> matrix.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="fine-tuning-publication-quality-ggplots.html#cb84-1" tabindex="-1"></a>ca_cider<span class="sc">$</span>eig <span class="co">#the second column has the percentage of variance explained by each dimension</span></span></code></pre></div>
<pre><code>##        eigenvalue percentage of variance cumulative percentage of variance
## dim 1 0.055398432              60.446394                          60.44639
## dim 2 0.017914259              19.546625                          79.99302
## dim 3 0.009328142              10.178132                          90.17115
## dim 4 0.005637110               6.150769                          96.32192
## dim 5 0.003370919               3.678080                         100.00000</code></pre>
<p>if you give <code>str_c()</code> multiple vectors with the same length, it’ll combine the first element of the first vector with the first element of the second vector, and so on. So we could easily make a list of plot labels for each axis we have:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="fine-tuning-publication-quality-ggplots.html#cb86-1" tabindex="-1"></a><span class="fu">str_c</span>(<span class="fu">rownames</span>(ca_cider<span class="sc">$</span>eig),</span>
<span id="cb86-2"><a href="fine-tuning-publication-quality-ggplots.html#cb86-2" tabindex="-1"></a>      <span class="st">&quot; (&quot;</span>, <span class="co"># you&#39;ll need to add the symbols yourself, including spaces</span></span>
<span id="cb86-3"><a href="fine-tuning-publication-quality-ggplots.html#cb86-3" tabindex="-1"></a>      <span class="fu">round</span>(ca_cider<span class="sc">$</span>eig[, <span class="dv">2</span>], <span class="dv">1</span>),</span>
<span id="cb86-4"><a href="fine-tuning-publication-quality-ggplots.html#cb86-4" tabindex="-1"></a>      <span class="st">&quot;%)&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;dim 1 (60.4%)&quot; &quot;dim 2 (19.5%)&quot; &quot;dim 3 (10.2%)&quot; &quot;dim 4 (6.2%)&quot; 
## [5] &quot;dim 5 (3.7%)&quot;</code></pre>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="fine-tuning-publication-quality-ggplots.html#cb88-1" tabindex="-1"></a><span class="co"># Or you can do it one at a time:</span></span>
<span id="cb88-2"><a href="fine-tuning-publication-quality-ggplots.html#cb88-2" tabindex="-1"></a><span class="fu">str_c</span>(<span class="st">&quot;Dimension 1 (&quot;</span>,</span>
<span id="cb88-3"><a href="fine-tuning-publication-quality-ggplots.html#cb88-3" tabindex="-1"></a>      <span class="fu">round</span>(ca_cider<span class="sc">$</span>eig[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">1</span>),</span>
<span id="cb88-4"><a href="fine-tuning-publication-quality-ggplots.html#cb88-4" tabindex="-1"></a>      <span class="st">&quot;% of intertia)&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Dimension 1 (60.4% of intertia)&quot;</code></pre>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="fine-tuning-publication-quality-ggplots.html#cb90-1" tabindex="-1"></a><span class="fu">str_c</span>(<span class="st">&quot;Dimension 2 (&quot;</span>,</span>
<span id="cb90-2"><a href="fine-tuning-publication-quality-ggplots.html#cb90-2" tabindex="-1"></a>      <span class="fu">round</span>(ca_cider<span class="sc">$</span>eig[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">1</span>),</span>
<span id="cb90-3"><a href="fine-tuning-publication-quality-ggplots.html#cb90-3" tabindex="-1"></a>      <span class="st">&quot;% of intertia)&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Dimension 2 (19.5% of intertia)&quot;</code></pre>
<p>To add it to the plot, we can use the <code>labs()</code> function, which lets you label the <code>x</code> and <code>y</code> axes, the whole plot <code>title</code>, and so on.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="fine-tuning-publication-quality-ggplots.html#cb92-1" tabindex="-1"></a>draft_cider_plot <span class="sc">+</span></span>
<span id="cb92-2"><a href="fine-tuning-publication-quality-ggplots.html#cb92-2" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">str_c</span>(<span class="st">&quot;Dimension 1, &quot;</span>, <span class="fu">round</span>(ca_cider<span class="sc">$</span>eig[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">1</span>), <span class="st">&quot;% of inertia&quot;</span>),</span>
<span id="cb92-3"><a href="fine-tuning-publication-quality-ggplots.html#cb92-3" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">str_c</span>(<span class="st">&quot;Dimension 2, &quot;</span>, <span class="fu">round</span>(ca_cider<span class="sc">$</span>eig[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">1</span>), <span class="st">&quot;% of inertia&quot;</span>),</span>
<span id="cb92-4"><a href="fine-tuning-publication-quality-ggplots.html#cb92-4" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Correspondence Analysis biplot (symmetric)&quot;</span>,</span>
<span id="cb92-5"><a href="fine-tuning-publication-quality-ggplots.html#cb92-5" tabindex="-1"></a>       <span class="co">#if you want to insert a line break, you can use `\n`:</span></span>
<span id="cb92-6"><a href="fine-tuning-publication-quality-ggplots.html#cb92-6" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Effect of cider serving temperature on consumer sensory perception</span><span class="sc">\n</span><span class="st">based on CATA data&quot;</span>)</span></code></pre></div>
<p><img src="03-finetuning-ggplot_files/figure-html/making%20wordy%20axis%20labels-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="setting-up-the-cartesian-plane" class="section level3 hasAnchor" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Setting up the Cartesian plane<a href="fine-tuning-publication-quality-ggplots.html#setting-up-the-cartesian-plane" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You may have noticed that <code>ggplot2</code> doesn’t give any particular weight to the origin, or the gridlines that pass through it, even though (0,0) is often meaningful and we may want to see which points are positive or negative at a glance. Removing all gridlines or using <code>theme_void()</code> removes the x- and y-axes as well!</p>
<p>The easiest way to address this is just to add two lines that are thicker/darker/different at <span class="math inline">\(y = 0\)</span> and <span class="math inline">\(x = 0\)</span>, which we can do by adding more <code>geom_*()</code>s…</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="fine-tuning-publication-quality-ggplots.html#cb93-1" tabindex="-1"></a>draft_cider_plot <span class="sc">+</span></span>
<span id="cb93-2"><a href="fine-tuning-publication-quality-ggplots.html#cb93-2" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb93-3"><a href="fine-tuning-publication-quality-ggplots.html#cb93-3" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb93-4"><a href="fine-tuning-publication-quality-ggplots.html#cb93-4" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>, <span class="at">linewidth =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="03-finetuning-ggplot_files/figure-html/using%20geom_vline%20and%20geom_hline%20at%20the%20end-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>But if you aren’t careful and add them <em>after</em> your other geoms, it will add them <em>on top</em> of the rest of the plot. In general, you should go ahead and add your axis lines right after calling <code>ggplot()</code>, before anything else, so that they’re drawn on first and every other <code>geom_*()</code> goes on top of it.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="fine-tuning-publication-quality-ggplots.html#cb94-1" tabindex="-1"></a>ca_cider_coords <span class="sc">%&gt;%</span></span>
<span id="cb94-2"><a href="fine-tuning-publication-quality-ggplots.html#cb94-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Dim 1</span><span class="st">`</span>, <span class="at">y =</span> <span class="st">`</span><span class="at">Dim 2</span><span class="st">`</span>, <span class="at">color =</span> type)) <span class="sc">+</span></span>
<span id="cb94-3"><a href="fine-tuning-publication-quality-ggplots.html#cb94-3" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb94-4"><a href="fine-tuning-publication-quality-ggplots.html#cb94-4" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb94-5"><a href="fine-tuning-publication-quality-ggplots.html#cb94-5" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb94-6"><a href="fine-tuning-publication-quality-ggplots.html#cb94-6" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">label =</span> name)) <span class="sc">+</span></span>
<span id="cb94-7"><a href="fine-tuning-publication-quality-ggplots.html#cb94-7" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div>
<p><img src="03-finetuning-ggplot_files/figure-html/using%20geom_vline%20and%20geom_hline%20at%20the%20beginning-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>You can also make your plot more intuitive to read by ensuring that 1 unit of the x-axis is the same distance as one unit on the y-axis, using <code>coord_equal()</code>.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="fine-tuning-publication-quality-ggplots.html#cb95-1" tabindex="-1"></a>ca_cider_coords <span class="sc">%&gt;%</span></span>
<span id="cb95-2"><a href="fine-tuning-publication-quality-ggplots.html#cb95-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Dim 1</span><span class="st">`</span>, <span class="at">y =</span> <span class="st">`</span><span class="at">Dim 2</span><span class="st">`</span>, <span class="at">color =</span> type)) <span class="sc">+</span></span>
<span id="cb95-3"><a href="fine-tuning-publication-quality-ggplots.html#cb95-3" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb95-4"><a href="fine-tuning-publication-quality-ggplots.html#cb95-4" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb95-5"><a href="fine-tuning-publication-quality-ggplots.html#cb95-5" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb95-6"><a href="fine-tuning-publication-quality-ggplots.html#cb95-6" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">label =</span> name)) <span class="sc">+</span></span>
<span id="cb95-7"><a href="fine-tuning-publication-quality-ggplots.html#cb95-7" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb95-8"><a href="fine-tuning-publication-quality-ggplots.html#cb95-8" tabindex="-1"></a>  <span class="fu">coord_equal</span>()</span></code></pre></div>
<p><img src="03-finetuning-ggplot_files/figure-html/making%20axes%20equally%20scaled-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>This will often make plots resulting from SVD wider than they are tall, since the 1st dimension will definitionally explain more variation in the data.</p>
</div>
<div id="using-only-part-of-the-dataset-for-each-geom" class="section level3 hasAnchor" number="3.3.3">
<h3><span class="header-section-number">3.3.3</span> Using only part of the dataset for each geom<a href="fine-tuning-publication-quality-ggplots.html#using-only-part-of-the-dataset-for-each-geom" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Many methods of SVD, including Correspondence Analysis, combine points from different datasets or yield coordinates for row and column variables that you may want to display significantly differently–maybe you want your PCA columns to be arrows instead of points, or (as you’ve seen above) having a point <em>and</em> a text label for every attribute is too busy. How do we plot only a subset of points for certain <code>geom_*()</code>s?</p>
<p>You already know how to make certain subsets of points a different shape, color, size, opacity, and so on. But how do you avoid plotting certain subsets at all?</p>
<p>You have to make a data frame with only the rows that you want e.g., <code>geom_point()</code>, to plot, and pass it into the <code>data</code> argument. We’ll show how to do this using the <code>tidyverse</code> function <code>filter()</code>, but if there’s another way you’re more comfortable with then use that instead.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="fine-tuning-publication-quality-ggplots.html#cb96-1" tabindex="-1"></a>ca_cider_coords <span class="sc">%&gt;%</span></span>
<span id="cb96-2"><a href="fine-tuning-publication-quality-ggplots.html#cb96-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Dim 1</span><span class="st">`</span>, <span class="at">y =</span> <span class="st">`</span><span class="at">Dim 2</span><span class="st">`</span>, <span class="at">color =</span> type)) <span class="sc">+</span></span>
<span id="cb96-3"><a href="fine-tuning-publication-quality-ggplots.html#cb96-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> ca_cider_coords <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">&quot;row&quot;</span>)) <span class="sc">+</span></span>
<span id="cb96-4"><a href="fine-tuning-publication-quality-ggplots.html#cb96-4" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">label =</span> name)) <span class="sc">+</span></span>
<span id="cb96-5"><a href="fine-tuning-publication-quality-ggplots.html#cb96-5" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="03-finetuning-ggplot_files/figure-html/plotting%20different%20datasets%20with%20different%20geoms-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>If the columns happened to have different names, you’d have to specify the <code>aes()</code> mappings separately in each <code>geom_*()</code>, and it may make more sense to start with an empty <code>ggplot()</code> call and then add on <code>geom_*()</code>s each with their own <code>mapping</code> and <code>data</code> arguments if there’s just one <code>geom_*()</code> per data frame.</p>
</div>
<div id="tweaking-legends" class="section level3 hasAnchor" number="3.3.4">
<h3><span class="header-section-number">3.3.4</span> Tweaking legends<a href="fine-tuning-publication-quality-ggplots.html#tweaking-legends" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Legends can often get busy, or have information on them that’s not actually clarifying anything in the plot, <em>especially</em> when you’ve got <code>geom_*()</code>s on the same plot using different datasets so that, for example, the color of the points isn’t adding anything.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="fine-tuning-publication-quality-ggplots.html#cb97-1" tabindex="-1"></a>ca_cider_coords <span class="sc">%&gt;%</span></span>
<span id="cb97-2"><a href="fine-tuning-publication-quality-ggplots.html#cb97-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Dim 1</span><span class="st">`</span>, <span class="at">y =</span> <span class="st">`</span><span class="at">Dim 2</span><span class="st">`</span>, <span class="at">color =</span> type)) <span class="sc">+</span></span>
<span id="cb97-3"><a href="fine-tuning-publication-quality-ggplots.html#cb97-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> Temperature),</span>
<span id="cb97-4"><a href="fine-tuning-publication-quality-ggplots.html#cb97-4" tabindex="-1"></a>             <span class="at">data =</span> ca_cider_coords <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">&quot;row&quot;</span>)) <span class="sc">+</span></span>
<span id="cb97-5"><a href="fine-tuning-publication-quality-ggplots.html#cb97-5" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">label =</span> name)) <span class="sc">+</span></span>
<span id="cb97-6"><a href="fine-tuning-publication-quality-ggplots.html#cb97-6" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="03-finetuning-ggplot_files/figure-html/messy%20legend%20example-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>If you want to remove <em>specific geoms</em> from the legend, then you have to adjust your <code>geom_*()</code> calls.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="fine-tuning-publication-quality-ggplots.html#cb98-1" tabindex="-1"></a>ca_cider_coords <span class="sc">%&gt;%</span></span>
<span id="cb98-2"><a href="fine-tuning-publication-quality-ggplots.html#cb98-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Dim 1</span><span class="st">`</span>, <span class="at">y =</span> <span class="st">`</span><span class="at">Dim 2</span><span class="st">`</span>, <span class="at">color =</span> type)) <span class="sc">+</span></span>
<span id="cb98-3"><a href="fine-tuning-publication-quality-ggplots.html#cb98-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> Temperature),</span>
<span id="cb98-4"><a href="fine-tuning-publication-quality-ggplots.html#cb98-4" tabindex="-1"></a>             <span class="at">data =</span> ca_cider_coords <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">&quot;row&quot;</span>),</span>
<span id="cb98-5"><a href="fine-tuning-publication-quality-ggplots.html#cb98-5" tabindex="-1"></a>             <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb98-6"><a href="fine-tuning-publication-quality-ggplots.html#cb98-6" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">label =</span> name)) <span class="sc">+</span></span>
<span id="cb98-7"><a href="fine-tuning-publication-quality-ggplots.html#cb98-7" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="03-finetuning-ggplot_files/figure-html/excluding%20geoms%20from%20the%20legend-1.png" width="672" style="display: block; margin: auto;" />
If you want to move specific <em>aesthetics</em> (<code>linetype</code>, <code>linewidth</code>, <code>color</code>, <code>shape</code>, etc) from the legend, then you can add the <code>guides()</code> function to your plot and specify which ones should be in the legend and which shouldn’t.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="fine-tuning-publication-quality-ggplots.html#cb99-1" tabindex="-1"></a>ca_cider_coords <span class="sc">%&gt;%</span></span>
<span id="cb99-2"><a href="fine-tuning-publication-quality-ggplots.html#cb99-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Dim 1</span><span class="st">`</span>, <span class="at">y =</span> <span class="st">`</span><span class="at">Dim 2</span><span class="st">`</span>, <span class="at">color =</span> type)) <span class="sc">+</span></span>
<span id="cb99-3"><a href="fine-tuning-publication-quality-ggplots.html#cb99-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> Temperature),</span>
<span id="cb99-4"><a href="fine-tuning-publication-quality-ggplots.html#cb99-4" tabindex="-1"></a>             <span class="at">data =</span> ca_cider_coords <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">&quot;row&quot;</span>)) <span class="sc">+</span></span>
<span id="cb99-5"><a href="fine-tuning-publication-quality-ggplots.html#cb99-5" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">label =</span> name)) <span class="sc">+</span></span>
<span id="cb99-6"><a href="fine-tuning-publication-quality-ggplots.html#cb99-6" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb99-7"><a href="fine-tuning-publication-quality-ggplots.html#cb99-7" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">shape =</span> <span class="fu">guide_legend</span>(),</span>
<span id="cb99-8"><a href="fine-tuning-publication-quality-ggplots.html#cb99-8" tabindex="-1"></a>         <span class="at">color =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="03-finetuning-ggplot_files/figure-html/excluding%20aesthetics%20from%20the%20legend-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="aesthetics-that-cant-use-scale_-functions" class="section level3 hasAnchor" number="3.3.5">
<h3><span class="header-section-number">3.3.5</span> Aesthetics that can’t use scale_*() functions<a href="fine-tuning-publication-quality-ggplots.html#aesthetics-that-cant-use-scale_-functions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>It’s also common for row and column biplots to use different text styling for the row and column <em>variables</em>. Based on what you know so far, since we have the row/column designation in the <code>type</code> column, you might start out trying to set the <code>fontface</code> aesthetic like this:</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="fine-tuning-publication-quality-ggplots.html#cb100-1" tabindex="-1"></a>ca_cider_coords <span class="sc">%&gt;%</span></span>
<span id="cb100-2"><a href="fine-tuning-publication-quality-ggplots.html#cb100-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Dim 1</span><span class="st">`</span>, <span class="at">y =</span> <span class="st">`</span><span class="at">Dim 2</span><span class="st">`</span>, <span class="at">color =</span> type)) <span class="sc">+</span> </span>
<span id="cb100-3"><a href="fine-tuning-publication-quality-ggplots.html#cb100-3" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb100-4"><a href="fine-tuning-publication-quality-ggplots.html#cb100-4" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">label =</span> name, <span class="at">fontface =</span> type)) <span class="sc">+</span></span>
<span id="cb100-5"><a href="fine-tuning-publication-quality-ggplots.html#cb100-5" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb100-6"><a href="fine-tuning-publication-quality-ggplots.html#cb100-6" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;darkorange&quot;</span>, <span class="st">&quot;darkgreen&quot;</span>))</span></code></pre></div>
<pre><code>## Error in FUN(X[[i]], ...): invalid fontface row</code></pre>
<p>You can map variable levels to colors, shapes, sizes, and so on using the <code>scale_*()</code> functions, but not all aesthetics can be controlled in this way. Most of the exceptions are related to text–font face, font family, and the justification of the text require that you have a variable that contains the name or value directly (<code>plain</code>, <code>bold</code>, <code>italic</code>, or <code>bold.italic</code> for <code>fontface</code>; <code>serif</code>, <code>sans</code>-serif, or <code>mono</code>space for <code>family</code>; and a number from 0-1 for <code>hjust</code> and <code>vjust</code>), if one <code>geom_text()</code> should have different values for different rows.</p>
<p>Basically, if we want to accomplish this in <code>ggplot2</code>, we’ll need to make a column with <code>plain</code> for our rows with samples and <code>italic</code> for our rows with CATA variables.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="fine-tuning-publication-quality-ggplots.html#cb102-1" tabindex="-1"></a>ca_cider_coords <span class="sc">%&gt;%</span></span>
<span id="cb102-2"><a href="fine-tuning-publication-quality-ggplots.html#cb102-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">font =</span> <span class="fu">if_else</span>(type <span class="sc">==</span> <span class="st">&quot;row&quot;</span>, <span class="st">&quot;plain&quot;</span>, <span class="st">&quot;italic&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb102-3"><a href="fine-tuning-publication-quality-ggplots.html#cb102-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Dim 1</span><span class="st">`</span>, <span class="at">y =</span> <span class="st">`</span><span class="at">Dim 2</span><span class="st">`</span>, <span class="at">color =</span> type)) <span class="sc">+</span> </span>
<span id="cb102-4"><a href="fine-tuning-publication-quality-ggplots.html#cb102-4" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb102-5"><a href="fine-tuning-publication-quality-ggplots.html#cb102-5" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">label =</span> name, <span class="at">fontface =</span> font)) <span class="sc">+</span></span>
<span id="cb102-6"><a href="fine-tuning-publication-quality-ggplots.html#cb102-6" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb102-7"><a href="fine-tuning-publication-quality-ggplots.html#cb102-7" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;darkorange&quot;</span>, <span class="st">&quot;darkgreen&quot;</span>))</span></code></pre></div>
<p><img src="03-finetuning-ggplot_files/figure-html/ggplot%20fontfaces%20the%20right%20way-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="putting-it-all-together-1" class="section level3 hasAnchor" number="3.3.6">
<h3><span class="header-section-number">3.3.6</span> Putting it all together<a href="fine-tuning-publication-quality-ggplots.html#putting-it-all-together-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Finally, as our last act, we’re ready to walk line-by-line through the last example figure, our fancier correspondence analysis plot.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="fine-tuning-publication-quality-ggplots.html#cb103-1" tabindex="-1"></a>nice_cider_labels <span class="ot">&lt;-</span></span>
<span id="cb103-2"><a href="fine-tuning-publication-quality-ggplots.html#cb103-2" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">str_c</span>(<span class="st">&quot;Dimension 1, &quot;</span>, <span class="fu">round</span>(ca_cider<span class="sc">$</span>eig[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">1</span>), <span class="st">&quot;% of inertia&quot;</span>),</span>
<span id="cb103-3"><a href="fine-tuning-publication-quality-ggplots.html#cb103-3" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">str_c</span>(<span class="st">&quot;Dimension 2, &quot;</span>, <span class="fu">round</span>(ca_cider<span class="sc">$</span>eig[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">1</span>), <span class="st">&quot;% of inertia&quot;</span>),</span>
<span id="cb103-4"><a href="fine-tuning-publication-quality-ggplots.html#cb103-4" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Correspondence Analysis biplot (symmetric)&quot;</span>,</span>
<span id="cb103-5"><a href="fine-tuning-publication-quality-ggplots.html#cb103-5" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Effect of cider serving temperature on consumer sensory perception&quot;</span>)</span>
<span id="cb103-6"><a href="fine-tuning-publication-quality-ggplots.html#cb103-6" tabindex="-1"></a></span>
<span id="cb103-7"><a href="fine-tuning-publication-quality-ggplots.html#cb103-7" tabindex="-1"></a>ca_cider_termplot <span class="ot">&lt;-</span></span>
<span id="cb103-8"><a href="fine-tuning-publication-quality-ggplots.html#cb103-8" tabindex="-1"></a>  ca_cider_coords <span class="sc">%&gt;%</span></span>
<span id="cb103-9"><a href="fine-tuning-publication-quality-ggplots.html#cb103-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">font =</span> <span class="fu">if_else</span>(type <span class="sc">==</span> <span class="st">&quot;row&quot;</span>, <span class="st">&quot;plain&quot;</span>, <span class="st">&quot;italic&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb103-10"><a href="fine-tuning-publication-quality-ggplots.html#cb103-10" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Dim 1</span><span class="st">`</span>, <span class="at">y =</span> <span class="st">`</span><span class="at">Dim 2</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb103-11"><a href="fine-tuning-publication-quality-ggplots.html#cb103-11" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">color =</span> <span class="st">&quot;darkgrey&quot;</span>) <span class="sc">+</span></span>
<span id="cb103-12"><a href="fine-tuning-publication-quality-ggplots.html#cb103-12" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">color =</span> <span class="st">&quot;darkgrey&quot;</span>) <span class="sc">+</span></span>
<span id="cb103-13"><a href="fine-tuning-publication-quality-ggplots.html#cb103-13" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> type, <span class="at">shape =</span> Temperature),</span>
<span id="cb103-14"><a href="fine-tuning-publication-quality-ggplots.html#cb103-14" tabindex="-1"></a>             <span class="at">data =</span> ca_cider_coords <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">&quot;row&quot;</span>),</span>
<span id="cb103-15"><a href="fine-tuning-publication-quality-ggplots.html#cb103-15" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb103-16"><a href="fine-tuning-publication-quality-ggplots.html#cb103-16" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> name, <span class="at">color =</span> type, <span class="at">fontface =</span> font),</span>
<span id="cb103-17"><a href="fine-tuning-publication-quality-ggplots.html#cb103-17" tabindex="-1"></a>                           <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb103-18"><a href="fine-tuning-publication-quality-ggplots.html#cb103-18" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span> </span>
<span id="cb103-19"><a href="fine-tuning-publication-quality-ggplots.html#cb103-19" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb103-20"><a href="fine-tuning-publication-quality-ggplots.html#cb103-20" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb103-21"><a href="fine-tuning-publication-quality-ggplots.html#cb103-21" tabindex="-1"></a>  nice_cider_labels <span class="sc">+</span> </span>
<span id="cb103-22"><a href="fine-tuning-publication-quality-ggplots.html#cb103-22" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;darkorange&quot;</span>, <span class="st">&quot;darkgreen&quot;</span>)) <span class="sc">+</span></span>
<span id="cb103-23"><a href="fine-tuning-publication-quality-ggplots.html#cb103-23" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">16</span>)) <span class="sc">+</span></span>
<span id="cb103-24"><a href="fine-tuning-publication-quality-ggplots.html#cb103-24" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">shape =</span> <span class="fu">guide_legend</span>(),</span>
<span id="cb103-25"><a href="fine-tuning-publication-quality-ggplots.html#cb103-25" tabindex="-1"></a>         <span class="at">color =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb103-26"><a href="fine-tuning-publication-quality-ggplots.html#cb103-26" tabindex="-1"></a></span>
<span id="cb103-27"><a href="fine-tuning-publication-quality-ggplots.html#cb103-27" tabindex="-1"></a>ca_cider_termplot</span></code></pre></div>
<p><img src="03-finetuning-ggplot_files/figure-html/final%20walkthrough%20of%20correspondence%20analysis-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="fine-tuning-publication-quality-ggplots.html#cb104-1" tabindex="-1"></a><span class="fu">save</span>(ca_cider_termplot, <span class="at">file =</span> <span class="st">&quot;data/ca_cider_termplot.RData&quot;</span>)</span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="the-basics-of-plotting-with-ggplot2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="wrap-up-and-further-resources.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
