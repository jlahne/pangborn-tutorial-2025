<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Wrangling data with tidyverse: Reshaping and combining tables | An introduction to R for sensory and consumer scientists</title>
  <meta name="description" content="4 Wrangling data with tidyverse: Reshaping and combining tables | An introduction to R for sensory and consumer scientists" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Wrangling data with tidyverse: Reshaping and combining tables | An introduction to R for sensory and consumer scientists" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="lhami/pangborn-tutorial-2023" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Wrangling data with tidyverse: Reshaping and combining tables | An introduction to R for sensory and consumer scientists" />
  
  
  

<meta name="author" content="Jacob Lahne" />
<meta name="author" content="Leah Hamilton" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="wrangling-data-with-tidyverse-rows-columns-and-groups.html"/>
<link rel="next" href="untidy-data-analysis.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction and welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#introductions"><i class="fa fa-check"></i>Introductions</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#jacob-lahne-phd"><i class="fa fa-check"></i>Jacob Lahne, PhD</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#leah-hamilton-phd"><i class="fa fa-check"></i>Leah Hamilton, PhD</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#todays-agenda"><i class="fa fa-check"></i>Today’s agenda</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-were-going-to-run"><i class="fa fa-check"></i>How we’re going to run</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#recommended-approach-for-livecoding"><i class="fa fa-check"></i>Recommended approach for livecoding</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#dealing-with-errors"><i class="fa fa-check"></i>Dealing with errors</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="a-crash-course-in-r.html"><a href="a-crash-course-in-r.html"><i class="fa fa-check"></i><b>1</b> A crash course in <code>R</code></a>
<ul>
<li class="chapter" data-level="1.1" data-path="a-crash-course-in-r.html"><a href="a-crash-course-in-r.html#r-vs-rstudio"><i class="fa fa-check"></i><b>1.1</b> <code>R</code> vs RStudio</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="a-crash-course-in-r.html"><a href="a-crash-course-in-r.html#what-is-r"><i class="fa fa-check"></i><b>1.1.1</b> What is <code>R</code>?</a></li>
<li class="chapter" data-level="1.1.2" data-path="a-crash-course-in-r.html"><a href="a-crash-course-in-r.html#great-why-are-we-using-rstudio-then"><i class="fa fa-check"></i><b>1.1.2</b> Great, why are we using RStudio then?</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="a-crash-course-in-r.html"><a href="a-crash-course-in-r.html#the-parts-of-rstudio"><i class="fa fa-check"></i><b>1.2</b> The parts of RStudio</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="a-crash-course-in-r.html"><a href="a-crash-course-in-r.html#the-working-directory-and-why-you-should-care"><i class="fa fa-check"></i><b>1.2.1</b> The “working directory” and why you should care</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="a-crash-course-in-r.html"><a href="a-crash-course-in-r.html#extending-r-with-packages"><i class="fa fa-check"></i><b>1.3</b> Extending <code>R</code> with packages</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="a-crash-course-in-r.html"><a href="a-crash-course-in-r.html#installing-packages"><i class="fa fa-check"></i><b>1.3.1</b> Installing packages</a></li>
<li class="chapter" data-level="1.3.2" data-path="a-crash-course-in-r.html"><a href="a-crash-course-in-r.html#loading-packages"><i class="fa fa-check"></i><b>1.3.2</b> Loading packages</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="a-crash-course-in-r.html"><a href="a-crash-course-in-r.html#getting-help"><i class="fa fa-check"></i><b>1.4</b> Getting help</a></li>
<li class="chapter" data-level="1.5" data-path="a-crash-course-in-r.html"><a href="a-crash-course-in-r.html#livecoding-along"><i class="fa fa-check"></i><b>1.5</b> Livecoding along</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="how-to-work-with-r.html"><a href="how-to-work-with-r.html"><i class="fa fa-check"></i><b>2</b> How to work with R</a>
<ul>
<li class="chapter" data-level="2.1" data-path="how-to-work-with-r.html"><a href="how-to-work-with-r.html#doing-math-and-creating-objects-in-r"><i class="fa fa-check"></i><b>2.1</b> Doing math and creating objects in <code>R</code></a></li>
<li class="chapter" data-level="2.2" data-path="how-to-work-with-r.html"><a href="how-to-work-with-r.html#functions-and-their-arguments-in-r"><i class="fa fa-check"></i><b>2.2</b> Functions and their arguments in <code>R</code></a></li>
<li class="chapter" data-level="2.3" data-path="how-to-work-with-r.html"><a href="how-to-work-with-r.html#reading-data-into-r"><i class="fa fa-check"></i><b>2.3</b> Reading data into <code>R</code></a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="how-to-work-with-r.html"><a href="how-to-work-with-r.html#where-the-data-lives"><i class="fa fa-check"></i><b>2.3.1</b> Where the data lives</a></li>
<li class="chapter" data-level="2.3.2" data-path="how-to-work-with-r.html"><a href="how-to-work-with-r.html#what-kind-of-file-are-we-importing"><i class="fa fa-check"></i><b>2.3.2</b> What kind of file are we importing?</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="how-to-work-with-r.html"><a href="how-to-work-with-r.html#data-in-r"><i class="fa fa-check"></i><b>2.4</b> Data in <code>R</code></a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="how-to-work-with-r.html"><a href="how-to-work-with-r.html#subsetting-data"><i class="fa fa-check"></i><b>2.4.1</b> Subsetting data</a></li>
<li class="chapter" data-level="2.4.2" data-path="how-to-work-with-r.html"><a href="how-to-work-with-r.html#complex-vectorslists-data.frame-and-tibble"><i class="fa fa-check"></i><b>2.4.2</b> Complex vectors/lists: <code>data.frame</code> and <code>tibble</code></a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="how-to-work-with-r.html"><a href="how-to-work-with-r.html#subsetting-and-wrangling-data-tables"><i class="fa fa-check"></i><b>2.5</b> Subsetting and wrangling data tables</a></li>
<li class="chapter" data-level="2.6" data-path="how-to-work-with-r.html"><a href="how-to-work-with-r.html#psa-not-knowing-is-normal"><i class="fa fa-check"></i><b>2.6</b> PSA: not-knowing is normal!</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="wrangling-data-with-tidyverse-rows-columns-and-groups.html"><a href="wrangling-data-with-tidyverse-rows-columns-and-groups.html"><i class="fa fa-check"></i><b>3</b> Wrangling data with <code>tidyverse</code>: Rows, Columns, and Groups</a>
<ul>
<li class="chapter" data-level="3.1" data-path="wrangling-data-with-tidyverse-rows-columns-and-groups.html"><a href="wrangling-data-with-tidyverse-rows-columns-and-groups.html#subsetting-data-1"><i class="fa fa-check"></i><b>3.1</b> Subsetting data</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="wrangling-data-with-tidyverse-rows-columns-and-groups.html"><a href="wrangling-data-with-tidyverse-rows-columns-and-groups.html#select-for-columns"><i class="fa fa-check"></i><b>3.1.1</b> <code>select()</code> for columns</a></li>
<li class="chapter" data-level="3.1.2" data-path="wrangling-data-with-tidyverse-rows-columns-and-groups.html"><a href="wrangling-data-with-tidyverse-rows-columns-and-groups.html#filter-for-rows"><i class="fa fa-check"></i><b>3.1.2</b> <code>filter()</code> for rows</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="wrangling-data-with-tidyverse-rows-columns-and-groups.html"><a href="wrangling-data-with-tidyverse-rows-columns-and-groups.html#combining-steps-with-the-pipe"><i class="fa fa-check"></i><b>3.2</b> Combining steps with the pipe: <code>%&gt;%</code></a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="wrangling-data-with-tidyverse-rows-columns-and-groups.html"><a href="wrangling-data-with-tidyverse-rows-columns-and-groups.html#pipes-require-that-the-lefthand-side-be-a-single-functional-command"><i class="fa fa-check"></i><b>3.2.1</b> Pipes require that the lefthand side be a single functional command</a></li>
<li class="chapter" data-level="3.2.2" data-path="wrangling-data-with-tidyverse-rows-columns-and-groups.html"><a href="wrangling-data-with-tidyverse-rows-columns-and-groups.html#pipes-always-pass-the-result-of-the-lefthand-side-to-the-first-argument-of-the-righthand-side"><i class="fa fa-check"></i><b>3.2.2</b> Pipes always pass the result of the lefthand side to the <em>first</em> argument of the righthand side</a></li>
<li class="chapter" data-level="3.2.3" data-path="wrangling-data-with-tidyverse-rows-columns-and-groups.html"><a href="wrangling-data-with-tidyverse-rows-columns-and-groups.html#pipes-are-a-pain-to-type"><i class="fa fa-check"></i><b>3.2.3</b> Pipes are a pain to type</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="wrangling-data-with-tidyverse-rows-columns-and-groups.html"><a href="wrangling-data-with-tidyverse-rows-columns-and-groups.html#make-new-columns-mutate"><i class="fa fa-check"></i><b>3.3</b> Make new columns: <code>mutate()</code></a></li>
<li class="chapter" data-level="3.4" data-path="wrangling-data-with-tidyverse-rows-columns-and-groups.html"><a href="wrangling-data-with-tidyverse-rows-columns-and-groups.html#split-apply-combine-analyses"><i class="fa fa-check"></i><b>3.4</b> Split-apply-combine analyses</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="wrangling-data-with-tidyverse-rows-columns-and-groups.html"><a href="wrangling-data-with-tidyverse-rows-columns-and-groups.html#groups-of-data-split-apply"><i class="fa fa-check"></i><b>3.4.1</b> Groups of data: Split-apply</a></li>
<li class="chapter" data-level="3.4.2" data-path="wrangling-data-with-tidyverse-rows-columns-and-groups.html"><a href="wrangling-data-with-tidyverse-rows-columns-and-groups.html#split-apply-combine-in-fewer-steps-with-summarize"><i class="fa fa-check"></i><b>3.4.2</b> Split-apply-combine in fewer steps with <code>summarize()</code></a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="wrangling-data-with-tidyverse-rows-columns-and-groups.html"><a href="wrangling-data-with-tidyverse-rows-columns-and-groups.html#groups-of-columns-and-across"><i class="fa fa-check"></i><b>3.5</b> Groups of columns and across()</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html"><i class="fa fa-check"></i><b>4</b> Wrangling data with <code>tidyverse</code>: Reshaping and combining tables</a>
<ul>
<li class="chapter" data-level="4.1" data-path="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#pivot-tables--wider-and-longer-data"><i class="fa fa-check"></i><b>4.1</b> Pivot tables- wider and longer data</a></li>
<li class="chapter" data-level="4.2" data-path="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#combining-data"><i class="fa fa-check"></i><b>4.2</b> Combining data</a></li>
<li class="chapter" data-level="4.3" data-path="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#utilities-for-data-management"><i class="fa fa-check"></i><b>4.3</b> Utilities for data management</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#rename-your-columns"><i class="fa fa-check"></i><b>4.3.1</b> Rename your columns</a></li>
<li class="chapter" data-level="4.3.2" data-path="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#relocate-your-columns"><i class="fa fa-check"></i><b>4.3.2</b> Relocate your columns</a></li>
<li class="chapter" data-level="4.3.3" data-path="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#remove-missing-values"><i class="fa fa-check"></i><b>4.3.3</b> Remove missing values</a></li>
<li class="chapter" data-level="4.3.4" data-path="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#counting-categorical-variables"><i class="fa fa-check"></i><b>4.3.4</b> Counting categorical variables</a></li>
<li class="chapter" data-level="4.3.5" data-path="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#sort-your-data"><i class="fa fa-check"></i><b>4.3.5</b> Sort your data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="untidy-data-analysis.html"><a href="untidy-data-analysis.html"><i class="fa fa-check"></i><b>5</b> Untidy Data Analysis</a>
<ul>
<li class="chapter" data-level="5.1" data-path="untidy-data-analysis.html"><a href="untidy-data-analysis.html#correspondence-analysis-overview"><i class="fa fa-check"></i><b>5.1</b> Correspondence Analysis Overview</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="untidy-data-analysis.html"><a href="untidy-data-analysis.html#the-ca-package"><i class="fa fa-check"></i><b>5.1.1</b> The CA package</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="untidy-data-analysis.html"><a href="untidy-data-analysis.html#categorical-character-binomial-binary-and-count-data"><i class="fa fa-check"></i><b>5.2</b> Categorical, Character, Binomial, Binary, and Count data</a></li>
<li class="chapter" data-level="5.3" data-path="untidy-data-analysis.html"><a href="untidy-data-analysis.html#untidy-analysis"><i class="fa fa-check"></i><b>5.3</b> Untidy Analysis</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="untidy-data-analysis.html"><a href="untidy-data-analysis.html#untidying-data"><i class="fa fa-check"></i><b>5.3.1</b> Untidying Data</a></li>
<li class="chapter" data-level="5.3.2" data-path="untidy-data-analysis.html"><a href="untidy-data-analysis.html#data-analysis"><i class="fa fa-check"></i><b>5.3.2</b> Data Analysis</a></li>
<li class="chapter" data-level="5.3.3" data-path="untidy-data-analysis.html"><a href="untidy-data-analysis.html#retidying-data"><i class="fa fa-check"></i><b>5.3.3</b> Retidying Data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-visualization-basics-with-ggplot2.html"><a href="data-visualization-basics-with-ggplot2.html"><i class="fa fa-check"></i><b>6</b> Data visualization basics with <code>ggplot2</code></a>
<ul>
<li class="chapter" data-level="6.1" data-path="data-visualization-basics-with-ggplot2.html"><a href="data-visualization-basics-with-ggplot2.html#built-in-plots-with-the-ca-package"><i class="fa fa-check"></i><b>6.1</b> Built-in plots with the ca package</a></li>
<li class="chapter" data-level="6.2" data-path="data-visualization-basics-with-ggplot2.html"><a href="data-visualization-basics-with-ggplot2.html#basics-of-tidy-graphics"><i class="fa fa-check"></i><b>6.2</b> Basics of Tidy Graphics</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="data-visualization-basics-with-ggplot2.html"><a href="data-visualization-basics-with-ggplot2.html#the-aes-function-and-mapping-argument"><i class="fa fa-check"></i><b>6.2.1</b> The <code>aes()</code> function and <code>mapping =</code> argument</a></li>
<li class="chapter" data-level="6.2.2" data-path="data-visualization-basics-with-ggplot2.html"><a href="data-visualization-basics-with-ggplot2.html#adding-layers-with-geom_-functions"><i class="fa fa-check"></i><b>6.2.2</b> Adding layers with <code>geom_*()</code> functions</a></li>
<li class="chapter" data-level="6.2.3" data-path="data-visualization-basics-with-ggplot2.html"><a href="data-visualization-basics-with-ggplot2.html#geoms-for-categorical-ordinal-or-unevenly-distributed-data"><i class="fa fa-check"></i><b>6.2.3</b> Geoms for categorical, ordinal, or unevenly-distributed data</a></li>
<li class="chapter" data-level="6.2.4" data-path="data-visualization-basics-with-ggplot2.html"><a href="data-visualization-basics-with-ggplot2.html#arguments-inside-and-outside-of-aes"><i class="fa fa-check"></i><b>6.2.4</b> Arguments inside and outside of <code>aes()</code></a></li>
<li class="chapter" data-level="6.2.5" data-path="data-visualization-basics-with-ggplot2.html"><a href="data-visualization-basics-with-ggplot2.html#using-theme_-to-change-visual-options-quickly"><i class="fa fa-check"></i><b>6.2.5</b> Using <code>theme_*()</code> to change visual options quickly</a></li>
<li class="chapter" data-level="6.2.6" data-path="data-visualization-basics-with-ggplot2.html"><a href="data-visualization-basics-with-ggplot2.html#changing-aesthetic-elements-with-scale_-functions"><i class="fa fa-check"></i><b>6.2.6</b> Changing aesthetic elements with <code>scale_*()</code> functions</a></li>
<li class="chapter" data-level="6.2.7" data-path="data-visualization-basics-with-ggplot2.html"><a href="data-visualization-basics-with-ggplot2.html#finally-facet_"><i class="fa fa-check"></i><b>6.2.7</b> Finally, <code>facet_*()</code></a></li>
<li class="chapter" data-level="6.2.8" data-path="data-visualization-basics-with-ggplot2.html"><a href="data-visualization-basics-with-ggplot2.html#the-ggplot-rabbithole"><i class="fa fa-check"></i><b>6.2.8</b> The ggplot rabbithole</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="data-visualization-basics-with-ggplot2.html"><a href="data-visualization-basics-with-ggplot2.html#better-ca-plots-with-ggplot2"><i class="fa fa-check"></i><b>6.3</b> Better CA plots with ggplot2</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="wrap-up-and-further-resources.html"><a href="wrap-up-and-further-resources.html"><i class="fa fa-check"></i><b>7</b> Wrap-up and further resources</a>
<ul>
<li class="chapter" data-level="7.1" data-path="wrap-up-and-further-resources.html"><a href="wrap-up-and-further-resources.html#getting-help-1"><i class="fa fa-check"></i><b>7.1</b> Getting help</a></li>
<li class="chapter" data-level="7.2" data-path="wrap-up-and-further-resources.html"><a href="wrap-up-and-further-resources.html#learning-more-with-sensometrics-society"><i class="fa fa-check"></i><b>7.2</b> Learning more with Sensometrics Society</a></li>
<li class="chapter" data-level="7.3" data-path="wrap-up-and-further-resources.html"><a href="wrap-up-and-further-resources.html#further-readingresources"><i class="fa fa-check"></i><b>7.3</b> Further reading/resources</a></li>
<li class="chapter" data-level="7.4" data-path="wrap-up-and-further-resources.html"><a href="wrap-up-and-further-resources.html#questionscomments"><i class="fa fa-check"></i><b>7.4</b> Questions/Comments</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">An introduction to R for sensory and consumer scientists</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="wrangling-data-with-tidyverse-reshaping-and-combining-tables" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> Wrangling data with <code>tidyverse</code>: Reshaping and combining tables<a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#wrangling-data-with-tidyverse-reshaping-and-combining-tables" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="pivot-tables--wider-and-longer-data" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Pivot tables- wider and longer data<a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#pivot-tables--wider-and-longer-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Users of Excel may be familiar with the idea of pivot tables. These are functions that let us make our data tidier. To quote Wickham and Grolemund:</p>
<blockquote>
<p>here are three interrelated rules which make a dataset tidy:</p>
<ol style="list-style-type: decimal">
<li>Each variable must have its own column.</li>
<li>Each observation must have its own row.</li>
<li>Each value must have its own cell.</li>
</ol>
</blockquote>
<p>While these authors present “tidiness” of data as an objective property, I’d argue that data is always tidy <strong>for a specific purpose</strong>. For example, our data is relatively tidy with one row per tasting event (one person tasting one berry), but this data still has an unruly number of variables (92 columns!!). You’ve already learned some tricks for dealing with large numbers of columns at once like <code>across()</code> and other functions using select helpers, but we have to do this <em>every time</em> we use <code>mutate()</code>, <code>summarize()</code>, or a similar function.</p>
<p>We could also treat the attribute or question as an independent variable affecting the response. If we take this view, then the tidiest dataset actually has one row for each person’s response to a single <code>question</code>. If we want to make plots or do other modelling, this <strong>longer</strong> form is often more tractable and lets us do operations on the whole dataset with less code.</p>
<p>We can use the <code>pivot_longer()</code> function to change our data to make the implicit variable explicit and to make our data tidier.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb178-1" tabindex="-1"></a>berry_data <span class="sc">%&gt;%</span></span>
<span id="cb178-2"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb178-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Subject Code</span><span class="st">`</span>, <span class="st">`</span><span class="at">Sample Name</span><span class="st">`</span>, berry, <span class="fu">starts_with</span>(<span class="st">&quot;cata_&quot;</span>), <span class="fu">starts_with</span>(<span class="st">&quot;9pt&quot;</span>)) <span class="sc">%&gt;%</span> <span class="co"># for clarity</span></span>
<span id="cb178-3"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb178-3" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;cata_&quot;</span>),</span>
<span id="cb178-4"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb178-4" tabindex="-1"></a>               <span class="at">names_prefix =</span> <span class="st">&quot;cata_&quot;</span>,</span>
<span id="cb178-5"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb178-5" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;attribute&quot;</span>,</span>
<span id="cb178-6"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb178-6" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;presence&quot;</span>) <span class="ot">-&gt;</span> berry_data_cata_long</span>
<span id="cb178-7"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb178-7" tabindex="-1"></a><span class="co">#The names_prefix will be *removed* from the start of every column name</span></span>
<span id="cb178-8"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb178-8" tabindex="-1"></a><span class="co">#before putting the rest of the name in the `names_to` column</span></span>
<span id="cb178-9"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb178-9" tabindex="-1"></a></span>
<span id="cb178-10"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb178-10" tabindex="-1"></a>berry_data_cata_long</span></code></pre></div>
<pre><code>## # A tibble: 270,252 × 10
##    `Subject Code` `Sample Name` berry `9pt_appearance` `9pt_overall` `9pt_taste`
##             &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;            &lt;dbl&gt;         &lt;dbl&gt;       &lt;dbl&gt;
##  1           1001 raspberry 6   rasp…                4             4           4
##  2           1001 raspberry 6   rasp…                4             4           4
##  3           1001 raspberry 6   rasp…                4             4           4
##  4           1001 raspberry 6   rasp…                4             4           4
##  5           1001 raspberry 6   rasp…                4             4           4
##  6           1001 raspberry 6   rasp…                4             4           4
##  7           1001 raspberry 6   rasp…                4             4           4
##  8           1001 raspberry 6   rasp…                4             4           4
##  9           1001 raspberry 6   rasp…                4             4           4
## 10           1001 raspberry 6   rasp…                4             4           4
## # ℹ 270,242 more rows
## # ℹ 4 more variables: `9pt_texture` &lt;dbl&gt;, `9pt_aroma` &lt;dbl&gt;, attribute &lt;chr&gt;,
## #   presence &lt;dbl&gt;</code></pre>
<p>Remember that <code>tibble</code>s and <code>data.frame</code>s can only have one data type per column (<code>logical &gt; integer &gt; numeric &gt; character</code>), however! If we have one row for each CATA, JAR, hedonic scale, AND free response question, the <code>value</code> column would have a mixture of different data types. This is why we have to tell <code>pivot_longer()</code> which <code>cols</code> to pull the <code>names</code> and <code>values</code> from.</p>
<p>Now for each unique combination of <code>Sample Name</code> and <code>Subject Code</code>, we have 36 rows, one for each CATA question that was asked. The variables that weren’t listed in the <code>cols</code> argument are just replicated on each of these rows. Each of the 36 rows that represent <code>Subject Code</code> 1001’s CATA responses for <code>raspberry 6</code> has the same <code>Subject Code</code>, <code>Sample Name</code>, <code>berry</code>, and various <code>9pt_</code> ratings as the other 35.</p>
<p>Sometimes we want to have “wider” or “untidy” data. We can use <code>pivot_wider()</code> to reverse the effects of <code>pivot_longer()</code>.</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb180-1" tabindex="-1"></a>berry_data_cata_long <span class="sc">%&gt;%</span></span>
<span id="cb180-2"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb180-2" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;attribute&quot;</span>,</span>
<span id="cb180-3"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb180-3" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="st">&quot;presence&quot;</span>,</span>
<span id="cb180-4"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb180-4" tabindex="-1"></a>              <span class="at">names_prefix =</span> <span class="st">&quot;cata_&quot;</span>) <span class="co">#pivot_wider *adds* the names_prefix</span></span></code></pre></div>
<pre><code>## # A tibble: 7,507 × 44
##    `Subject Code` `Sample Name` berry `9pt_appearance` `9pt_overall` `9pt_taste`
##             &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;            &lt;dbl&gt;         &lt;dbl&gt;       &lt;dbl&gt;
##  1           1001 raspberry 6   rasp…                4             4           4
##  2           1001 raspberry 5   rasp…                8             9           9
##  3           1001 raspberry 2   rasp…                4             3           3
##  4           1001 raspberry 3   rasp…                7             7           6
##  5           1001 raspberry 4   rasp…                7             4           3
##  6           1001 raspberry 1   rasp…                7             4           3
##  7           1002 raspberry 6   rasp…                6             4           4
##  8           1002 raspberry 5   rasp…                8             7           4
##  9           1002 raspberry 2   rasp…                8             7           6
## 10           1002 raspberry 3   rasp…                7             9           9
## # ℹ 7,497 more rows
## # ℹ 38 more variables: `9pt_texture` &lt;dbl&gt;, `9pt_aroma` &lt;dbl&gt;,
## #   cata_appearance_unevencolor &lt;dbl&gt;, cata_appearance_misshapen &lt;dbl&gt;,
## #   cata_appearance_creased &lt;dbl&gt;, cata_appearance_seedy &lt;dbl&gt;,
## #   cata_appearance_bruised &lt;dbl&gt;, cata_appearance_notfresh &lt;dbl&gt;,
## #   cata_appearance_fresh &lt;dbl&gt;, cata_appearance_goodshape &lt;dbl&gt;,
## #   cata_appearance_goodquality &lt;dbl&gt;, cata_appearance_none &lt;dbl&gt;, …</code></pre>
<p>Pivoting is an incredibly powerful and incredibly common data manipulation technique that will become even more powerful when we need to make complex graphs later. Different functions and analyses may require the data in different longer or wider formats, and you will often find yourself starting with even less tidy data than what we’ve provided.</p>
<p>For an example of this power, let’s imagine that we want to compare the 3 different liking scales by normalizing each by the <code>mean()</code> and <code>sd()</code> of that particular scale, then comparing average liking for each attribute of each berry across the three scales.</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb182-1" tabindex="-1"></a>berry_data <span class="sc">%&gt;%</span></span>
<span id="cb182-2"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb182-2" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="fu">c</span>(<span class="st">&quot;9pt_&quot;</span>,<span class="st">&quot;lms_&quot;</span>,<span class="st">&quot;us_&quot;</span>)),</span>
<span id="cb182-3"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb182-3" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;scale&quot;</span>, <span class="st">&quot;attribute&quot;</span>),</span>
<span id="cb182-4"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb182-4" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>,</span>
<span id="cb182-5"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb182-5" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;rating&quot;</span>,</span>
<span id="cb182-6"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb182-6" tabindex="-1"></a>               <span class="at">values_drop_na =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb182-7"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb182-7" tabindex="-1"></a>  <span class="fu">group_by</span>(scale) <span class="sc">%&gt;%</span></span>
<span id="cb182-8"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb182-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">normalized_rating =</span> (rating <span class="sc">-</span> <span class="fu">mean</span>(rating)) <span class="sc">/</span> <span class="fu">sd</span>(rating)) <span class="sc">%&gt;%</span></span>
<span id="cb182-9"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb182-9" tabindex="-1"></a>  <span class="fu">group_by</span>(scale, attribute, berry) <span class="sc">%&gt;%</span></span>
<span id="cb182-10"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb182-10" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_liking =</span> <span class="fu">mean</span>(normalized_rating)) <span class="sc">%&gt;%</span></span>
<span id="cb182-11"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb182-11" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> scale,</span>
<span id="cb182-12"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb182-12" tabindex="-1"></a>              <span class="at">values_from =</span> avg_liking)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;scale&#39;, &#39;attribute&#39;. You can override
## using the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 17 × 5
## # Groups:   attribute [5]
##    attribute  berry         `9pt`      lms      us
##    &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
##  1 appearance blackberry  0.284    0.364    0.327 
##  2 appearance blueberry   0.381    0.424    0.462 
##  3 appearance raspberry   0.246    0.236    0.223 
##  4 appearance strawberry -0.164   -0.226   -0.220 
##  5 aroma      strawberry  0.0351  -0.0676  -0.0951
##  6 overall    blackberry -0.177   -0.209   -0.177 
##  7 overall    blueberry   0.0234   0.0576   0.166 
##  8 overall    raspberry   0.0261   0.0300   0.0707
##  9 overall    strawberry -0.150   -0.179   -0.200 
## 10 taste      blackberry -0.289   -0.301   -0.336 
## 11 taste      blueberry  -0.0611   0.0202   0.0366
## 12 taste      raspberry  -0.0291  -0.0336  -0.0359
## 13 taste      strawberry -0.306   -0.292   -0.339 
## 14 texture    blackberry -0.0467   0.00645 -0.0118
## 15 texture    blueberry   0.159    0.202    0.284 
## 16 texture    raspberry  -0.00677 -0.00607  0.0289
## 17 texture    strawberry -0.0602  -0.0531  -0.0768</code></pre>
<p>While pivoting may seem simple at first, it can also get pretty confusing! That example required two different pivots! We’ll be using these tools throughout the rest of the tutorial, so I wanted to give exposure, but mastering them takes trial and error. I recommend taking a look at the <a href="https://r4ds.had.co.nz/tidy-data.html">relevant chapter in Wickham and Grolemund</a> for details.</p>
</div>
<div id="combining-data" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Combining data<a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#combining-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>While we’ve been using a single dataset read in from one <code>.csv</code> file, this will not always be the way your data is stored when you start working with it. There may be several surveys you’re combining, or a separate file with survey responses, another with your blinding code key, and still another with data from a collaborator.</p>
<p>The <code>tidyverse</code> verb that you use for this combination depends on whether your datasets have matching columns/variables (say, data from two different years or locations of a project) or matching rows/observations (say, sensory and chemical data).</p>
<p>The “matching variables” case can also happen if we want to stack the outputs of multiple independent <code>summarize()</code> calls, such as making a stacked demographic table. Since our data doesn’t have demographic data removed, let’s instead try to make a table that reports our sample size for each <code>berry</code> type and each of the three kinds of liking scales.</p>
<p>If we wanted the combinations of these levels (e.g., the sample size of 9-pt scale ratings of strawberries), we could use one <code>summarize()</code> or <code>count()</code> call, but we need to do a little extra work if we want to <code>summarize()</code> the whole dataset more than one different way.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb185-1" tabindex="-1"></a>berry_type_counts <span class="ot">&lt;-</span></span>
<span id="cb185-2"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb185-2" tabindex="-1"></a>  berry_data <span class="sc">%&gt;%</span></span>
<span id="cb185-3"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb185-3" tabindex="-1"></a>  <span class="fu">group_by</span>(berry) <span class="sc">%&gt;%</span></span>
<span id="cb185-4"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb185-4" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n_distinct</span>(<span class="st">`</span><span class="at">Subject Code</span><span class="st">`</span>, test_day)) <span class="sc">%&gt;%</span></span>
<span id="cb185-5"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb185-5" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Level =</span> berry)</span>
<span id="cb185-6"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb185-6" tabindex="-1"></a></span>
<span id="cb185-7"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb185-7" tabindex="-1"></a>berry_scale_counts <span class="ot">&lt;-</span></span>
<span id="cb185-8"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb185-8" tabindex="-1"></a>  berry_data <span class="sc">%&gt;%</span></span>
<span id="cb185-9"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb185-9" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">ends_with</span>(<span class="st">&quot;_overall&quot;</span>),</span>
<span id="cb185-10"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb185-10" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>, <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;Scale&quot;</span>, <span class="cn">NA</span>),</span>
<span id="cb185-11"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb185-11" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;Used&quot;</span>, <span class="at">values_drop_na =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb185-12"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb185-12" tabindex="-1"></a>  <span class="fu">group_by</span>(Scale) <span class="sc">%&gt;%</span></span>
<span id="cb185-13"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb185-13" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n_distinct</span>(<span class="st">`</span><span class="at">Subject Code</span><span class="st">`</span>, test_day)) <span class="sc">%&gt;%</span></span>
<span id="cb185-14"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb185-14" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Level =</span> Scale)</span>
<span id="cb185-15"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb185-15" tabindex="-1"></a></span>
<span id="cb185-16"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb185-16" tabindex="-1"></a><span class="co">#These are both summarizing the same set of observations into different groups:</span></span>
<span id="cb185-17"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb185-17" tabindex="-1"></a><span class="fu">sum</span>(berry_scale_counts<span class="sc">$</span>n)</span></code></pre></div>
<pre><code>## [1] 1301</code></pre>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb187-1" tabindex="-1"></a><span class="fu">sum</span>(berry_type_counts<span class="sc">$</span>n)</span></code></pre></div>
<pre><code>## [1] 1301</code></pre>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb189-1" tabindex="-1"></a><span class="co">#Hence needing two summarize() calls</span></span>
<span id="cb189-2"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb189-2" tabindex="-1"></a></span>
<span id="cb189-3"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb189-3" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="at">Berry =</span> berry_type_counts,</span>
<span id="cb189-4"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb189-4" tabindex="-1"></a>          <span class="at">Scale =</span> berry_scale_counts,</span>
<span id="cb189-5"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb189-5" tabindex="-1"></a>          <span class="at">.id =</span> <span class="st">&quot;Variable&quot;</span>) <span class="co">#This makes a new column called &quot;Variable&quot; which will</span></span></code></pre></div>
<pre><code>## # A tibble: 7 × 3
##   Variable Level          n
##   &lt;chr&gt;    &lt;chr&gt;      &lt;int&gt;
## 1 Berry    blackberry   299
## 2 Berry    blueberry    313
## 3 Berry    raspberry    358
## 4 Berry    strawberry   331
## 5 Scale    9pt          423
## 6 Scale    lms          435
## 7 Scale    us           443</code></pre>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb191-1" tabindex="-1"></a>                            <span class="co">#specify which of the two tables each row came from</span></span></code></pre></div>
<p>For multiple tables that share the same observations, we could want to add follow-up survey data using the same participants or genetic information about the berries. In the latter case, our table of berry genetics would have less rows, but the <code>tidyverse</code> actually handles them with the same verbs.</p>
<p>There <em>is</em> a <code>bind_cols()</code> function, but it’s easy to accidentally have the raspberries on the top in one table and the blueberries on the top in another, or to have one table sorted alphabetically and another by blinding code or participant ID, so it’s safer to use the <code>*_join()</code> functions if you’re adding columns instead of rows. <code>left_join()</code> is the most common.</p>
<p>We’ll make up some demographic data to join to our existing table.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb192-1" tabindex="-1"></a>demographics <span class="ot">&lt;-</span></span>
<span id="cb192-2"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb192-2" tabindex="-1"></a>  berry_data <span class="sc">%&gt;%</span></span>
<span id="cb192-3"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb192-3" tabindex="-1"></a>  <span class="fu">distinct</span>(<span class="st">`</span><span class="at">Subject Code</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb192-4"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb192-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age =</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="dv">45</span>, <span class="dv">6</span>)),</span>
<span id="cb192-5"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb192-5" tabindex="-1"></a>         <span class="at">Gender =</span> <span class="fu">ifelse</span>(<span class="fu">rbinom</span>(<span class="fu">n</span>(), <span class="dv">1</span>, <span class="fl">0.6</span>), <span class="st">&quot;F&quot;</span>, <span class="st">&quot;M&quot;</span>),</span>
<span id="cb192-6"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb192-6" tabindex="-1"></a>         <span class="at">Location =</span> <span class="fu">sample</span>(state.name, <span class="fu">n</span>(), <span class="at">replace =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb192-7"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb192-7" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ID =</span> <span class="st">`</span><span class="at">Subject Code</span><span class="st">`</span>) <span class="co">#To demonstrate how you can manually configure</span></span>
<span id="cb192-8"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb192-8" tabindex="-1"></a>                              <span class="co">#the columns used to align the datasets</span></span>
<span id="cb192-9"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb192-9" tabindex="-1"></a></span>
<span id="cb192-10"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb192-10" tabindex="-1"></a><span class="co">#And now we can join it:</span></span>
<span id="cb192-11"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb192-11" tabindex="-1"></a>berry_data <span class="sc">%&gt;%</span></span>
<span id="cb192-12"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb192-12" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Age, <span class="sc">-</span>Gender) <span class="sc">%&gt;%</span> <span class="co">#Getting rid of the empty demographic columns first</span></span>
<span id="cb192-13"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb192-13" tabindex="-1"></a>  <span class="fu">left_join</span>(demographics, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;Subject Code&quot;</span> <span class="ot">=</span> <span class="st">&quot;ID&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 7,507 × 93
##    `Subject Code` `Participant Name` `Start Time (UTC)` `End Time (UTC)`
##             &lt;dbl&gt;              &lt;dbl&gt; &lt;chr&gt;              &lt;chr&gt;           
##  1           1001               1001 6/13/2019 21:05    6/13/2019 21:09 
##  2           1001               1001 6/13/2019 20:55    6/13/2019 20:59 
##  3           1001               1001 6/13/2019 20:49    6/13/2019 20:53 
##  4           1001               1001 6/13/2019 20:45    6/13/2019 20:48 
##  5           1001               1001 6/13/2019 21:00    6/13/2019 21:03 
##  6           1001               1001 6/13/2019 21:10    6/13/2019 21:13 
##  7           1002               1002 6/13/2019 20:08    6/13/2019 20:11 
##  8           1002               1002 6/13/2019 19:57    6/13/2019 20:01 
##  9           1002               1002 6/13/2019 20:13    6/13/2019 20:17 
## 10           1002               1002 6/13/2019 20:03    6/13/2019 20:07 
## # ℹ 7,497 more rows
## # ℹ 89 more variables: `Serving Position` &lt;dbl&gt;, `Sample Identifier` &lt;dbl&gt;,
## #   `Sample Name` &lt;chr&gt;, `9pt_appearance` &lt;dbl&gt;, pre_expectation &lt;dbl&gt;,
## #   jar_color &lt;dbl&gt;, jar_gloss &lt;dbl&gt;, jar_size &lt;dbl&gt;,
## #   cata_appearance_unevencolor &lt;dbl&gt;, cata_appearance_misshapen &lt;dbl&gt;,
## #   cata_appearance_creased &lt;dbl&gt;, cata_appearance_seedy &lt;dbl&gt;,
## #   cata_appearance_bruised &lt;dbl&gt;, cata_appearance_notfresh &lt;dbl&gt;, …</code></pre>
<p><code>anti_join()</code> can be used to <em>remove</em> data. If you have a list of participants whose responses had data quality issues, you can put it in the second argument of <code>anti_join()</code> to return the lefthand table with those entries removed.</p>
<p>We do have some repeat participants in the berry tests, because they were allowed to participate for each berry type once. But in online surveys, repeat answers could be a problem necessitating all data removal. Let’s demonstrate how we’d do that with <code>anti_join()</code>:</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb194-1" tabindex="-1"></a>problem_participants <span class="ot">&lt;-</span></span>
<span id="cb194-2"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb194-2" tabindex="-1"></a>  berry_data <span class="sc">%&gt;%</span></span>
<span id="cb194-3"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb194-3" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Participant Name</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb194-4"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb194-4" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">sessions =</span> <span class="fu">n_distinct</span>(test_day)) <span class="sc">%&gt;%</span></span>
<span id="cb194-5"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb194-5" tabindex="-1"></a>  <span class="fu">filter</span>(sessions <span class="sc">&gt;</span> <span class="dv">1</span>)</span>
<span id="cb194-6"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb194-6" tabindex="-1"></a></span>
<span id="cb194-7"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb194-7" tabindex="-1"></a>berry_data <span class="sc">%&gt;%</span></span>
<span id="cb194-8"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb194-8" tabindex="-1"></a>  <span class="fu">anti_join</span>(problem_participants)</span></code></pre></div>
<pre><code>## Joining with `by = join_by(`Participant Name`)`</code></pre>
<pre><code>## # A tibble: 3,755 × 92
##    `Subject Code` `Participant Name` Gender Age   `Start Time (UTC)`
##             &lt;dbl&gt;              &lt;dbl&gt; &lt;lgl&gt;  &lt;lgl&gt; &lt;chr&gt;             
##  1           1001               1001 NA     NA    6/13/2019 21:05   
##  2           1001               1001 NA     NA    6/13/2019 20:55   
##  3           1001               1001 NA     NA    6/13/2019 20:49   
##  4           1001               1001 NA     NA    6/13/2019 20:45   
##  5           1001               1001 NA     NA    6/13/2019 21:00   
##  6           1001               1001 NA     NA    6/13/2019 21:10   
##  7           1002               1002 NA     NA    6/13/2019 20:08   
##  8           1002               1002 NA     NA    6/13/2019 19:57   
##  9           1002               1002 NA     NA    6/13/2019 20:13   
## 10           1002               1002 NA     NA    6/13/2019 20:03   
## # ℹ 3,745 more rows
## # ℹ 87 more variables: `End Time (UTC)` &lt;chr&gt;, `Serving Position` &lt;dbl&gt;,
## #   `Sample Identifier` &lt;dbl&gt;, `Sample Name` &lt;chr&gt;, `9pt_appearance` &lt;dbl&gt;,
## #   pre_expectation &lt;dbl&gt;, jar_color &lt;dbl&gt;, jar_gloss &lt;dbl&gt;, jar_size &lt;dbl&gt;,
## #   cata_appearance_unevencolor &lt;dbl&gt;, cata_appearance_misshapen &lt;dbl&gt;,
## #   cata_appearance_creased &lt;dbl&gt;, cata_appearance_seedy &lt;dbl&gt;,
## #   cata_appearance_bruised &lt;dbl&gt;, cata_appearance_notfresh &lt;dbl&gt;, …</code></pre>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb197-1" tabindex="-1"></a><span class="co">#We don&#39;t need to specify by if they share the column name they&#39;re joining on</span></span>
<span id="cb197-2"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb197-2" tabindex="-1"></a><span class="co">#and NO OTHERS</span></span></code></pre></div>
<p><code>anti_join()</code> also gives priority to the first/lefthand argument, usually the one you’re piping in with <code>%&gt;%</code>. It returns the rows in your left tibble that don’t have corresponding entries in the righthand one. It also does <em>not</em> add the columns that are unique to your right table. There is no <code>n</code> column in the output.</p>
</div>
<div id="utilities-for-data-management" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Utilities for data management<a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#utilities-for-data-management" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Honestly, the amount of power in <code>tidyverse</code> is way more than we can cover today, and is covered more comprehensively (obviously) by <a href="https://r4ds.had.co.nz/">Wickham and Grolemund</a>. However, I want to name a few more utilities we will make a lot of use of today (and you will want to know about for your own work).</p>
<div id="rename-your-columns" class="section level3 hasAnchor" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Rename your columns<a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#rename-your-columns" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Often you will import data with bad column names or you’ll realize you need to rename variables during your workflow. This is one way to get around having to type a bunch of backticks forever. For this, you can use the <code>rename()</code> function:</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb198-1" tabindex="-1"></a><span class="fu">names</span>(berry_data)</span></code></pre></div>
<pre><code>##  [1] &quot;Subject Code&quot;                &quot;Participant Name&quot;           
##  [3] &quot;Gender&quot;                      &quot;Age&quot;                        
##  [5] &quot;Start Time (UTC)&quot;            &quot;End Time (UTC)&quot;             
##  [7] &quot;Serving Position&quot;            &quot;Sample Identifier&quot;          
##  [9] &quot;Sample Name&quot;                 &quot;9pt_appearance&quot;             
## [11] &quot;pre_expectation&quot;             &quot;jar_color&quot;                  
## [13] &quot;jar_gloss&quot;                   &quot;jar_size&quot;                   
## [15] &quot;cata_appearance_unevencolor&quot; &quot;cata_appearance_misshapen&quot;  
## [17] &quot;cata_appearance_creased&quot;     &quot;cata_appearance_seedy&quot;      
## [19] &quot;cata_appearance_bruised&quot;     &quot;cata_appearance_notfresh&quot;   
## [21] &quot;cata_appearance_fresh&quot;       &quot;cata_appearance_goodshape&quot;  
## [23] &quot;cata_appearance_goodquality&quot; &quot;cata_appearance_none&quot;       
## [25] &quot;9pt_overall&quot;                 &quot;verbal_likes&quot;               
## [27] &quot;verbal_dislikes&quot;             &quot;9pt_taste&quot;                  
## [29] &quot;grid_sweetness&quot;              &quot;grid_tartness&quot;              
## [31] &quot;grid_raspberryflavor&quot;        &quot;jar_sweetness&quot;              
## [33] &quot;jar_tartness&quot;                &quot;cata_taste_floral&quot;          
## [35] &quot;cata_taste_berry&quot;            &quot;cata_taste_green&quot;           
## [37] &quot;cata_taste_grassy&quot;           &quot;cata_taste_fermented&quot;       
## [39] &quot;cata_taste_tropical&quot;         &quot;cata_taste_fruity&quot;          
## [41] &quot;cata_taste_citrus&quot;           &quot;cata_taste_earthy&quot;          
## [43] &quot;cata_taste_candy&quot;            &quot;cata_taste_none&quot;            
## [45] &quot;9pt_texture&quot;                 &quot;grid_seediness&quot;             
## [47] &quot;grid_firmness&quot;               &quot;grid_juiciness&quot;             
## [49] &quot;jar_firmness&quot;                &quot;jar_juciness&quot;               
## [51] &quot;post_expectation&quot;            &quot;price&quot;                      
## [53] &quot;product_tier&quot;                &quot;purchase_intent&quot;            
## [55] &quot;subject&quot;                     &quot;test_day&quot;                   
## [57] &quot;us_appearance&quot;               &quot;us_overall&quot;                 
## [59] &quot;us_taste&quot;                    &quot;us_texture&quot;                 
## [61] &quot;lms_appearance&quot;              &quot;lms_overall&quot;                
## [63] &quot;lms_taste&quot;                   &quot;lms_texture&quot;                
## [65] &quot;cata_appearane_bruised&quot;      &quot;cata_appearance_goodshapre&quot; 
## [67] &quot;cata_appearance_goodcolor&quot;   &quot;grid_blackberryflavor&quot;      
## [69] &quot;cata_taste_cinnamon&quot;         &quot;cata_taste_lemon&quot;           
## [71] &quot;cata_taste_clove&quot;            &quot;cata_taste_minty&quot;           
## [73] &quot;cata_taste_grape&quot;            &quot;grid_crispness&quot;             
## [75] &quot;jar_crispness&quot;               &quot;jar_juiciness&quot;              
## [77] &quot;cata_appearane_creased&quot;      &quot;grid_blueberryflavor&quot;       
## [79] &quot;cata_taste_piney&quot;            &quot;cata_taste_peachy&quot;          
## [81] &quot;9pt_aroma&quot;                   &quot;grid_strawberryflavor&quot;      
## [83] &quot;cata_taste_caramel&quot;          &quot;cata_taste_grapey&quot;          
## [85] &quot;cata_taste_melon&quot;            &quot;cata_taste_cherry&quot;          
## [87] &quot;grid_crunchiness&quot;            &quot;jar_crunch&quot;                 
## [89] &quot;us_aroma&quot;                    &quot;lms_aroma&quot;                  
## [91] &quot;berry&quot;                       &quot;sample&quot;</code></pre>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb200-1" tabindex="-1"></a>berry_data <span class="sc">%&gt;%</span></span>
<span id="cb200-2"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb200-2" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Sample =</span> <span class="st">`</span><span class="at">Sample Name</span><span class="st">`</span>,</span>
<span id="cb200-3"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb200-3" tabindex="-1"></a>         <span class="at">Subject =</span> <span class="st">`</span><span class="at">Participant Name</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb200-4"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb200-4" tabindex="-1"></a>  <span class="fu">select</span>(Subject, Sample, <span class="fu">everything</span>()) <span class="co">#no more backticks!</span></span></code></pre></div>
<pre><code>## # A tibble: 7,507 × 92
##    Subject Sample      `Subject Code` Gender Age   `Start Time (UTC)`
##      &lt;dbl&gt; &lt;chr&gt;                &lt;dbl&gt; &lt;lgl&gt;  &lt;lgl&gt; &lt;chr&gt;             
##  1    1001 raspberry 6           1001 NA     NA    6/13/2019 21:05   
##  2    1001 raspberry 5           1001 NA     NA    6/13/2019 20:55   
##  3    1001 raspberry 2           1001 NA     NA    6/13/2019 20:49   
##  4    1001 raspberry 3           1001 NA     NA    6/13/2019 20:45   
##  5    1001 raspberry 4           1001 NA     NA    6/13/2019 21:00   
##  6    1001 raspberry 1           1001 NA     NA    6/13/2019 21:10   
##  7    1002 raspberry 6           1002 NA     NA    6/13/2019 20:08   
##  8    1002 raspberry 5           1002 NA     NA    6/13/2019 19:57   
##  9    1002 raspberry 2           1002 NA     NA    6/13/2019 20:13   
## 10    1002 raspberry 3           1002 NA     NA    6/13/2019 20:03   
## # ℹ 7,497 more rows
## # ℹ 86 more variables: `End Time (UTC)` &lt;chr&gt;, `Serving Position` &lt;dbl&gt;,
## #   `Sample Identifier` &lt;dbl&gt;, `9pt_appearance` &lt;dbl&gt;, pre_expectation &lt;dbl&gt;,
## #   jar_color &lt;dbl&gt;, jar_gloss &lt;dbl&gt;, jar_size &lt;dbl&gt;,
## #   cata_appearance_unevencolor &lt;dbl&gt;, cata_appearance_misshapen &lt;dbl&gt;,
## #   cata_appearance_creased &lt;dbl&gt;, cata_appearance_seedy &lt;dbl&gt;,
## #   cata_appearance_bruised &lt;dbl&gt;, cata_appearance_notfresh &lt;dbl&gt;, …</code></pre>
<p>You can also rename by position, but be sure you have the right order and don’t change the input data later:</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb202-1" tabindex="-1"></a>berry_data <span class="sc">%&gt;%</span></span>
<span id="cb202-2"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb202-2" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Subject =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 7,507 × 92
##    Subject `Participant Name` Gender Age   `Start Time (UTC)` `End Time (UTC)`
##      &lt;dbl&gt;              &lt;dbl&gt; &lt;lgl&gt;  &lt;lgl&gt; &lt;chr&gt;              &lt;chr&gt;           
##  1    1001               1001 NA     NA    6/13/2019 21:05    6/13/2019 21:09 
##  2    1001               1001 NA     NA    6/13/2019 20:55    6/13/2019 20:59 
##  3    1001               1001 NA     NA    6/13/2019 20:49    6/13/2019 20:53 
##  4    1001               1001 NA     NA    6/13/2019 20:45    6/13/2019 20:48 
##  5    1001               1001 NA     NA    6/13/2019 21:00    6/13/2019 21:03 
##  6    1001               1001 NA     NA    6/13/2019 21:10    6/13/2019 21:13 
##  7    1002               1002 NA     NA    6/13/2019 20:08    6/13/2019 20:11 
##  8    1002               1002 NA     NA    6/13/2019 19:57    6/13/2019 20:01 
##  9    1002               1002 NA     NA    6/13/2019 20:13    6/13/2019 20:17 
## 10    1002               1002 NA     NA    6/13/2019 20:03    6/13/2019 20:07 
## # ℹ 7,497 more rows
## # ℹ 86 more variables: `Serving Position` &lt;dbl&gt;, `Sample Identifier` &lt;dbl&gt;,
## #   `Sample Name` &lt;chr&gt;, `9pt_appearance` &lt;dbl&gt;, pre_expectation &lt;dbl&gt;,
## #   jar_color &lt;dbl&gt;, jar_gloss &lt;dbl&gt;, jar_size &lt;dbl&gt;,
## #   cata_appearance_unevencolor &lt;dbl&gt;, cata_appearance_misshapen &lt;dbl&gt;,
## #   cata_appearance_creased &lt;dbl&gt;, cata_appearance_seedy &lt;dbl&gt;,
## #   cata_appearance_bruised &lt;dbl&gt;, cata_appearance_notfresh &lt;dbl&gt;, …</code></pre>
</div>
<div id="relocate-your-columns" class="section level3 hasAnchor" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Relocate your columns<a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#relocate-your-columns" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If you <code>mutate()</code> columns or just have a big data set with a lot of variables, often you want to move columns around. This is a pain to do with <code>[]</code>, but again <code>tidyverse</code> has a utility to move things around easily: <code>relocate()</code>.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb204-1" tabindex="-1"></a>berry_data <span class="sc">%&gt;%</span></span>
<span id="cb204-2"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb204-2" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="st">`</span><span class="at">Sample Name</span><span class="st">`</span>) <span class="co"># giving no other arguments will move to front</span></span></code></pre></div>
<pre><code>## # A tibble: 7,507 × 92
##    `Sample Name` `Subject Code` `Participant Name` Gender Age  
##    &lt;chr&gt;                  &lt;dbl&gt;              &lt;dbl&gt; &lt;lgl&gt;  &lt;lgl&gt;
##  1 raspberry 6             1001               1001 NA     NA   
##  2 raspberry 5             1001               1001 NA     NA   
##  3 raspberry 2             1001               1001 NA     NA   
##  4 raspberry 3             1001               1001 NA     NA   
##  5 raspberry 4             1001               1001 NA     NA   
##  6 raspberry 1             1001               1001 NA     NA   
##  7 raspberry 6             1002               1002 NA     NA   
##  8 raspberry 5             1002               1002 NA     NA   
##  9 raspberry 2             1002               1002 NA     NA   
## 10 raspberry 3             1002               1002 NA     NA   
## # ℹ 7,497 more rows
## # ℹ 87 more variables: `Start Time (UTC)` &lt;chr&gt;, `End Time (UTC)` &lt;chr&gt;,
## #   `Serving Position` &lt;dbl&gt;, `Sample Identifier` &lt;dbl&gt;,
## #   `9pt_appearance` &lt;dbl&gt;, pre_expectation &lt;dbl&gt;, jar_color &lt;dbl&gt;,
## #   jar_gloss &lt;dbl&gt;, jar_size &lt;dbl&gt;, cata_appearance_unevencolor &lt;dbl&gt;,
## #   cata_appearance_misshapen &lt;dbl&gt;, cata_appearance_creased &lt;dbl&gt;,
## #   cata_appearance_seedy &lt;dbl&gt;, cata_appearance_bruised &lt;dbl&gt;, …</code></pre>
<p>You can also use <code>relocate()</code> to specify positions</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb206-1" tabindex="-1"></a>berry_data <span class="sc">%&gt;%</span></span>
<span id="cb206-2"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb206-2" tabindex="-1"></a>  <span class="fu">relocate</span>(Gender, Age, <span class="st">`</span><span class="at">Subject Code</span><span class="st">`</span>, <span class="st">`</span><span class="at">Start Time (UTC)</span><span class="st">`</span>, <span class="st">`</span><span class="at">End Time (UTC)</span><span class="st">`</span>, <span class="st">`</span><span class="at">Sample Identifier</span><span class="st">`</span>, <span class="at">.after =</span> berry) <span class="co"># move repetitive and empty columns to the end</span></span></code></pre></div>
<pre><code>## # A tibble: 7,507 × 92
##    `Participant Name` `Serving Position` `Sample Name` `9pt_appearance`
##                 &lt;dbl&gt;              &lt;dbl&gt; &lt;chr&gt;                    &lt;dbl&gt;
##  1               1001                  5 raspberry 6                  4
##  2               1001                  3 raspberry 5                  8
##  3               1001                  2 raspberry 2                  4
##  4               1001                  1 raspberry 3                  7
##  5               1001                  4 raspberry 4                  7
##  6               1001                  6 raspberry 1                  7
##  7               1002                  3 raspberry 6                  6
##  8               1002                  1 raspberry 5                  8
##  9               1002                  4 raspberry 2                  8
## 10               1002                  2 raspberry 3                  7
## # ℹ 7,497 more rows
## # ℹ 88 more variables: pre_expectation &lt;dbl&gt;, jar_color &lt;dbl&gt;, jar_gloss &lt;dbl&gt;,
## #   jar_size &lt;dbl&gt;, cata_appearance_unevencolor &lt;dbl&gt;,
## #   cata_appearance_misshapen &lt;dbl&gt;, cata_appearance_creased &lt;dbl&gt;,
## #   cata_appearance_seedy &lt;dbl&gt;, cata_appearance_bruised &lt;dbl&gt;,
## #   cata_appearance_notfresh &lt;dbl&gt;, cata_appearance_fresh &lt;dbl&gt;,
## #   cata_appearance_goodshape &lt;dbl&gt;, cata_appearance_goodquality &lt;dbl&gt;, …</code></pre>
</div>
<div id="remove-missing-values" class="section level3 hasAnchor" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> Remove missing values<a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#remove-missing-values" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Missing values (the <code>NA</code>s you’ve been seeing so much) can be a huge pain, because they make more of themselves.</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb208-1" tabindex="-1"></a><span class="fu">mean</span>(berry_data<span class="sc">$</span>price) <span class="co">#This column had no NAs, so we can take the average</span></span></code></pre></div>
<pre><code>## [1] 2.962896</code></pre>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb210-1" tabindex="-1"></a><span class="fu">mean</span>(berry_data<span class="sc">$</span><span class="st">`</span><span class="at">9pt_overall</span><span class="st">`</span>) <span class="co">#This column has some NAs, so we get NA</span></span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>Many base R functions that take a vector and return some mathematical function (e.g., <code>mean()</code>, <code>sum()</code>, <code>sd()</code>) have an argument called <code>na.rm</code> that can be set to just act as if the values aren’t there at all.</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb212-1" tabindex="-1"></a><span class="fu">mean</span>(berry_data<span class="sc">$</span><span class="st">`</span><span class="at">9pt_overall</span><span class="st">`</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="co">#We get the average of only the valid numbers</span></span></code></pre></div>
<pre><code>## [1] 5.679346</code></pre>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb214-1" tabindex="-1"></a><span class="fu">sum</span>(berry_data<span class="sc">$</span><span class="st">`</span><span class="at">9pt_overall</span><span class="st">`</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span></span>
<span id="cb214-2"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb214-2" tabindex="-1"></a>  <span class="fu">length</span>(berry_data<span class="sc">$</span><span class="st">`</span><span class="at">9pt_overall</span><span class="st">`</span>) <span class="co">#The denominator is NOT the same as the total number of values anymore</span></span></code></pre></div>
<pre><code>## [1] 1.84974</code></pre>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb216-1" tabindex="-1"></a><span class="fu">sum</span>(berry_data<span class="sc">$</span><span class="st">`</span><span class="at">9pt_overall</span><span class="st">`</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span></span>
<span id="cb216-2"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb216-2" tabindex="-1"></a>  <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(berry_data<span class="sc">$</span><span class="st">`</span><span class="at">9pt_overall</span><span class="st">`</span>)) <span class="co">#The denominator is the number of non-NA values</span></span></code></pre></div>
<pre><code>## [1] 5.679346</code></pre>
<p>However, this isn’t always convenient. Sometimes it may be easier to simply get rid of all observations with any missing values, which tidyverse has a handy <code>drop_na()</code> function for:</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb218-1" tabindex="-1"></a>berry_data <span class="sc">%&gt;%</span></span>
<span id="cb218-2"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb218-2" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="co">#All of our rows have *some* NA values, so this returns nothing</span></span></code></pre></div>
<pre><code>## # A tibble: 0 × 92
## # ℹ 92 variables: Subject Code &lt;dbl&gt;, Participant Name &lt;dbl&gt;, Gender &lt;lgl&gt;,
## #   Age &lt;lgl&gt;, Start Time (UTC) &lt;chr&gt;, End Time (UTC) &lt;chr&gt;,
## #   Serving Position &lt;dbl&gt;, Sample Identifier &lt;dbl&gt;, Sample Name &lt;chr&gt;,
## #   9pt_appearance &lt;dbl&gt;, pre_expectation &lt;dbl&gt;, jar_color &lt;dbl&gt;,
## #   jar_gloss &lt;dbl&gt;, jar_size &lt;dbl&gt;, cata_appearance_unevencolor &lt;dbl&gt;,
## #   cata_appearance_misshapen &lt;dbl&gt;, cata_appearance_creased &lt;dbl&gt;,
## #   cata_appearance_seedy &lt;dbl&gt;, cata_appearance_bruised &lt;dbl&gt;, …</code></pre>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb220-1" tabindex="-1"></a>berry_data <span class="sc">%&gt;%</span></span>
<span id="cb220-2"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb220-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Participant Name</span><span class="st">`</span>, <span class="st">`</span><span class="at">Sample Name</span><span class="st">`</span>, <span class="fu">contains</span>(<span class="st">&quot;9pt_&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb220-3"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb220-3" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="co">#Now we get only respondants who answered all 9-point liking questions.</span></span></code></pre></div>
<pre><code>## # A tibble: 600 × 7
##    `Participant Name` `Sample Name` `9pt_appearance` `9pt_overall` `9pt_taste`
##                 &lt;dbl&gt; &lt;chr&gt;                    &lt;dbl&gt;         &lt;dbl&gt;       &lt;dbl&gt;
##  1               2001 Strawberry4                  5             5           4
##  2               2001 Strawberry1                  6             2           2
##  3               2001 Strawberry2                  1             6           6
##  4               2001 Strawberry6                  3             3           2
##  5               2001 Strawberry3                  8             7           8
##  6               2001 Strawberry5                  4             6           6
##  7               2002 Strawberry4                  2             4           3
##  8               2002 Strawberry1                  4             6           7
##  9               2002 Strawberry2                  3             6           6
## 10               2002 Strawberry6                  7             7           8
## # ℹ 590 more rows
## # ℹ 2 more variables: `9pt_texture` &lt;dbl&gt;, `9pt_aroma` &lt;dbl&gt;</code></pre>
<p>Or you may want to remove any columns/variables that have some missing data, which is one of the most common uses of <code>where()</code>:</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb222-1" tabindex="-1"></a>berry_data <span class="sc">%&gt;%</span></span>
<span id="cb222-2"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb222-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(<span class="sc">~</span><span class="fu">none</span>(.x, is.na))) <span class="co">#Only 38 columns with absolutely no missing values.</span></span></code></pre></div>
<pre><code>## # A tibble: 7,507 × 38
##    `Subject Code` `Participant Name` `Start Time (UTC)` `End Time (UTC)`
##             &lt;dbl&gt;              &lt;dbl&gt; &lt;chr&gt;              &lt;chr&gt;           
##  1           1001               1001 6/13/2019 21:05    6/13/2019 21:09 
##  2           1001               1001 6/13/2019 20:55    6/13/2019 20:59 
##  3           1001               1001 6/13/2019 20:49    6/13/2019 20:53 
##  4           1001               1001 6/13/2019 20:45    6/13/2019 20:48 
##  5           1001               1001 6/13/2019 21:00    6/13/2019 21:03 
##  6           1001               1001 6/13/2019 21:10    6/13/2019 21:13 
##  7           1002               1002 6/13/2019 20:08    6/13/2019 20:11 
##  8           1002               1002 6/13/2019 19:57    6/13/2019 20:01 
##  9           1002               1002 6/13/2019 20:13    6/13/2019 20:17 
## 10           1002               1002 6/13/2019 20:03    6/13/2019 20:07 
## # ℹ 7,497 more rows
## # ℹ 34 more variables: `Serving Position` &lt;dbl&gt;, `Sample Identifier` &lt;dbl&gt;,
## #   `Sample Name` &lt;chr&gt;, pre_expectation &lt;dbl&gt;, jar_color &lt;dbl&gt;,
## #   jar_size &lt;dbl&gt;, cata_appearance_unevencolor &lt;dbl&gt;,
## #   cata_appearance_misshapen &lt;dbl&gt;, cata_appearance_notfresh &lt;dbl&gt;,
## #   cata_appearance_fresh &lt;dbl&gt;, cata_appearance_goodquality &lt;dbl&gt;,
## #   cata_appearance_none &lt;dbl&gt;, grid_sweetness &lt;dbl&gt;, grid_tartness &lt;dbl&gt;, …</code></pre>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb224-1" tabindex="-1"></a><span class="co">#This loses all of the liking data.</span></span></code></pre></div>
<p>Both of the above methods guarantee that you will have an output with absolutely no missing data, but may be over-zealous if, say, everyone answered overall liking on one of the three scales and we want to do some work to combine those later. <code>filter()</code> and <code>select()</code> can be combined to do infinitely complex missing value removal.</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb225-1" tabindex="-1"></a>berry_data <span class="sc">%&gt;%</span></span>
<span id="cb225-2"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb225-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(<span class="sc">~!</span><span class="fu">every</span>(.x, is.na))) <span class="sc">%&gt;%</span> <span class="co">#remove columns with no data</span></span>
<span id="cb225-3"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb225-3" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(<span class="fu">is.na</span>(<span class="st">`</span><span class="at">9pt_aroma</span><span class="st">`</span>) <span class="sc">&amp;</span> <span class="fu">is.na</span>(lms_aroma) <span class="sc">&amp;</span> <span class="fu">is.na</span>(us_aroma)))</span></code></pre></div>
<pre><code>## # A tibble: 1,986 × 90
##    `Subject Code` `Participant Name` `Start Time (UTC)` `End Time (UTC)`
##             &lt;dbl&gt;              &lt;dbl&gt; &lt;chr&gt;              &lt;chr&gt;           
##  1           2001               2001 6/24/2019 20:18    6/24/2019 20:22 
##  2           2001               2001 6/24/2019 20:30    6/24/2019 20:35 
##  3           2001               2001 6/24/2019 20:23    6/24/2019 20:28 
##  4           2001               2001 6/24/2019 20:14    6/24/2019 20:17 
##  5           2001               2001 6/24/2019 20:35    6/24/2019 20:39 
##  6           2001               2001 6/24/2019 20:08    6/24/2019 20:13 
##  7           2002               2002 6/24/2019 20:21    6/24/2019 20:25 
##  8           2002               2002 6/24/2019 20:14    6/24/2019 20:17 
##  9           2002               2002 6/24/2019 19:59    6/24/2019 20:04 
## 10           2002               2002 6/24/2019 20:09    6/24/2019 20:13 
## # ℹ 1,976 more rows
## # ℹ 86 more variables: `Serving Position` &lt;dbl&gt;, `Sample Identifier` &lt;dbl&gt;,
## #   `Sample Name` &lt;chr&gt;, `9pt_appearance` &lt;dbl&gt;, pre_expectation &lt;dbl&gt;,
## #   jar_color &lt;dbl&gt;, jar_gloss &lt;dbl&gt;, jar_size &lt;dbl&gt;,
## #   cata_appearance_unevencolor &lt;dbl&gt;, cata_appearance_misshapen &lt;dbl&gt;,
## #   cata_appearance_creased &lt;dbl&gt;, cata_appearance_seedy &lt;dbl&gt;,
## #   cata_appearance_bruised &lt;dbl&gt;, cata_appearance_notfresh &lt;dbl&gt;, …</code></pre>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb227-1" tabindex="-1"></a><span class="co">#You&#39;ll notice that only strawberries have any non-NA liking values, actually</span></span></code></pre></div>
</div>
<div id="counting-categorical-variables" class="section level3 hasAnchor" number="4.3.4">
<h3><span class="header-section-number">4.3.4</span> Counting categorical variables<a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#counting-categorical-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Often, we’ll want to count how many observations are in a group without having to actually count ourselves. Do we have enough observations for each sample? How many people in each demographic category do we have? Is it balanced?</p>
<p>You’ve already written code to do this, if you’ve been following along! <code>summarize()</code> is incredibly powerful, and it will happily use <em>any</em> function that takes a vector or vectors and returns a single value. This includes categorical or <code>chr</code> data!</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb228-1" tabindex="-1"></a>berry_data <span class="sc">%&gt;%</span></span>
<span id="cb228-2"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb228-2" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Sample Name</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb228-3"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb228-3" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n_responses =</span> <span class="fu">n</span>())</span></code></pre></div>
<pre><code>## # A tibble: 23 × 2
##    `Sample Name` n_responses
##    &lt;chr&gt;               &lt;int&gt;
##  1 Blackberry 1          299
##  2 Blackberry 2          299
##  3 Blackberry 3          299
##  4 Blackberry 4          299
##  5 Blackberry 5          299
##  6 Blueberry 1           313
##  7 Blueberry 2           313
##  8 Blueberry 3           313
##  9 Blueberry 4           313
## 10 Blueberry 5           313
## # ℹ 13 more rows</code></pre>
<p>We can also do this with a little less typing using <code>count()</code>, which is handy if we’re repeatedly doing a lot of counting observations in various categories (like for CATA tests and Correspondence Analyses):</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb230-1" tabindex="-1"></a>berry_data <span class="sc">%&gt;%</span></span>
<span id="cb230-2"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb230-2" tabindex="-1"></a>  <span class="fu">count</span>(<span class="st">`</span><span class="at">Sample Name</span><span class="st">`</span>) <span class="co">#Counts the number of observations (rows) of each berry</span></span></code></pre></div>
<pre><code>## # A tibble: 23 × 2
##    `Sample Name`     n
##    &lt;chr&gt;         &lt;int&gt;
##  1 Blackberry 1    299
##  2 Blackberry 2    299
##  3 Blackberry 3    299
##  4 Blackberry 4    299
##  5 Blackberry 5    299
##  6 Blueberry 1     313
##  7 Blueberry 2     313
##  8 Blueberry 3     313
##  9 Blueberry 4     313
## 10 Blueberry 5     313
## # ℹ 13 more rows</code></pre>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb232-1" tabindex="-1"></a>berry_data <span class="sc">%&gt;%</span></span>
<span id="cb232-2"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb232-2" tabindex="-1"></a>  <span class="fu">count</span>(berry) <span class="co">#Number of observations, *not necessarily* the number of participants!</span></span></code></pre></div>
<pre><code>## # A tibble: 4 × 2
##   berry          n
##   &lt;chr&gt;      &lt;int&gt;
## 1 blackberry  1495
## 2 blueberry   1878
## 3 raspberry   2148
## 4 strawberry  1986</code></pre>
<p>Depending on the shape of your data, the number of rows may or may not be the count you actually want. Maybe we want to know how many people participated in each day of testing, but we have one row per <em>tasting event</em>.</p>
<p>We could use <code>pivot_wider()</code> to reshape our data first, so we have one row per <em>completed tasting session</em>, but since <code>count()</code> drops most columns anyways, we only really need one row for each thing we care about. <code>distinct()</code> can be handy here. It keeps one row for each <strong>distinct</strong> combination of the columns you give it, getting rid of all other columns so it doesn’t have to worry about the fact that one person gave multiple different <code>9pt_overall</code> ratings per <code>test_day</code>.</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb234-1" tabindex="-1"></a>berry_data <span class="sc">%&gt;%</span></span>
<span id="cb234-2"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb234-2" tabindex="-1"></a>  <span class="fu">distinct</span>(test_day, <span class="st">`</span><span class="at">Subject Code</span><span class="st">`</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1,301 × 2
##    test_day        `Subject Code`
##    &lt;chr&gt;                    &lt;dbl&gt;
##  1 Raspberry Day 1           1001
##  2 Raspberry Day 1           1002
##  3 Raspberry Day 1           1004
##  4 Raspberry Day 1           1005
##  5 Raspberry Day 1           1006
##  6 Raspberry Day 1           1007
##  7 Raspberry Day 1           1008
##  8 Raspberry Day 1           1009
##  9 Raspberry Day 1           1010
## 10 Raspberry Day 1           1011
## # ℹ 1,291 more rows</code></pre>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb236-1" tabindex="-1"></a><span class="co">#Two columns, with one row for each completed tasting session</span></span>
<span id="cb236-2"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb236-2" tabindex="-1"></a><span class="co">#(each reflects 5-6 rows in the initial data)</span></span>
<span id="cb236-3"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb236-3" tabindex="-1"></a></span>
<span id="cb236-4"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb236-4" tabindex="-1"></a>berry_data <span class="sc">%&gt;%</span></span>
<span id="cb236-5"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb236-5" tabindex="-1"></a>  <span class="fu">distinct</span>(test_day, <span class="st">`</span><span class="at">Subject Code</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb236-6"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb236-6" tabindex="-1"></a>  <span class="fu">count</span>(test_day)</span></code></pre></div>
<pre><code>## # A tibble: 12 × 2
##    test_day             n
##    &lt;chr&gt;            &lt;int&gt;
##  1 Blackberry Day 1   108
##  2 Blackberry Day 2    88
##  3 Blackberry Day 3   103
##  4 Blueberry Day 1    102
##  5 Blueberry Day 2    114
##  6 Blueberry Day 3     97
##  7 Raspberry Day 1    131
##  8 Raspberry Day 2    120
##  9 Raspberry Day 3    107
## 10 Strawberry Day 1   108
## 11 Strawberry Day 2   106
## 12 Strawberry Day 3   117</code></pre>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb238-1" tabindex="-1"></a><span class="co">#Counts the number of participants per testing day</span></span></code></pre></div>
</div>
<div id="sort-your-data" class="section level3 hasAnchor" number="4.3.5">
<h3><span class="header-section-number">4.3.5</span> Sort your data<a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#sort-your-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>More frequently, we will want to rearrange our rows, which can be done with <code>arrange()</code>. All you have to do is give <code>arrange()</code> one or more columns to sort the data by. You can use either the <code>desc()</code> or the <code>-</code> shortcut to sort in reverse order. Whether ascending or descending, <code>arrange()</code> places missing values at the bottom.</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb239-1" tabindex="-1"></a>berry_data <span class="sc">%&gt;%</span></span>
<span id="cb239-2"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb239-2" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(lms_overall)) <span class="sc">%&gt;%</span> <span class="co"># which berries had the highest liking on the lms?</span></span>
<span id="cb239-3"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb239-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Sample Name</span><span class="st">`</span>, <span class="st">`</span><span class="at">Participant Name</span><span class="st">`</span>, lms_overall)</span></code></pre></div>
<pre><code>## # A tibble: 7,507 × 3
##    `Sample Name` `Participant Name` lms_overall
##    &lt;chr&gt;                      &lt;dbl&gt;       &lt;dbl&gt;
##  1 raspberry 2                 5135         100
##  2 raspberry 6                 7033         100
##  3 Blackberry 4                5273         100
##  4 Blackberry 4                7135         100
##  5 Blackberry 3                7135         100
##  6 Blackberry 5                7135         100
##  7 Blueberry 5                 5113         100
##  8 Blueberry 6                 5127         100
##  9 Blueberry 3                 7040         100
## 10 Strawberry1                 1273         100
## # ℹ 7,497 more rows</code></pre>
<p>You can sort alphabetically as well:</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb241-1" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">state_name =</span> state.name, <span class="at">area =</span> state.area) <span class="sc">%&gt;%</span> <span class="co"># using a dataset of US States for demonstration</span></span>
<span id="cb241-2"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb241-2" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(state_name))                            <span class="co"># sort states reverse-alphabetically</span></span></code></pre></div>
<pre><code>## # A tibble: 50 × 2
##    state_name      area
##    &lt;chr&gt;          &lt;dbl&gt;
##  1 Wyoming        97914
##  2 Wisconsin      56154
##  3 West Virginia  24181
##  4 Washington     68192
##  5 Virginia       40815
##  6 Vermont         9609
##  7 Utah           84916
##  8 Texas         267339
##  9 Tennessee      42244
## 10 South Dakota   77047
## # ℹ 40 more rows</code></pre>
<p>It’s not a bad idea to restart your R session here. Make sure to save your work, but a clean <code>Environment</code> is great when we’re shifting topics.</p>
<p>You can accomplish this by going to <code>Session &gt; Restart R</code> in the menu.</p>
<p>Then, we want to make sure to re-load our packages and import our data.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb243-1" tabindex="-1"></a><span class="co"># The packages we&#39;re using</span></span>
<span id="cb243-2"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb243-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb243-3"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb243-3" tabindex="-1"></a><span class="fu">library</span>(ca)</span>
<span id="cb243-4"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb243-4" tabindex="-1"></a></span>
<span id="cb243-5"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb243-5" tabindex="-1"></a><span class="co"># The dataset</span></span>
<span id="cb243-6"><a href="wrangling-data-with-tidyverse-reshaping-and-combining-tables.html#cb243-6" tabindex="-1"></a>berry_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/clt-berry-data.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 7507 Columns: 92
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr  (7): Start Time (UTC), End Time (UTC), Sample Name, verbal_likes, verba...
## dbl (83): Subject Code, Participant Name, Serving Position, Sample Identifie...
## lgl  (2): Gender, Age
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="wrangling-data-with-tidyverse-rows-columns-and-groups.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="untidy-data-analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
